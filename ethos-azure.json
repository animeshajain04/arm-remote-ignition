{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "outputs": {
        "agentcontrolFQDN": {
            "type": "string",
            "value": "[reference(concat('Microsoft.Network/publicIPAddresses/', variables('agentcontrolIPAddressName'))).dnsSettings.fqdn]"
        },
        "agentproxyFQDN": {
            "type": "string",
            "value": "[reference(concat('Microsoft.Network/publicIPAddresses/', variables('agentproxyIPAddressName'))).dnsSettings.fqdn]"
        },
        "agentworkerFQDN": {
            "type": "string",
            "value": "[reference(concat('Microsoft.Network/publicIPAddresses/', variables('agentworkerIPAddressName'))).dnsSettings.fqdn]"
        },
        "agentworkeraetherFQDN": {
            "type": "string",
            "value": "[reference(concat('Microsoft.Network/publicIPAddresses/', variables('agentworkeraetherIPAddressName'))).dnsSettings.fqdn]"
        },
        "masterFQDN": {
            "type": "string",
            "value": "[reference(concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))).dnsSettings.fqdn]"
        }
    },
    "parameters": {
        "agentcontrolCount": {
            "allowedValues": [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16,
                17,
                18,
                19,
                20,
                21,
                22,
                23,
                24,
                25,
                26,
                27,
                28,
                29,
                30,
                31,
                32,
                33,
                34,
                35,
                36,
                37,
                38,
                39,
                40,
                41,
                42,
                43,
                44,
                45,
                46,
                47,
                48,
                49,
                50,
                51,
                52,
                53,
                54,
                55,
                56,
                57,
                58,
                59,
                60,
                61,
                62,
                63,
                64,
                65,
                66,
                67,
                68,
                69,
                70,
                71,
                72,
                73,
                74,
                75,
                76,
                77,
                78,
                79,
                80,
                81,
                82,
                83,
                84,
                85,
                86,
                87,
                88,
                89,
                90,
                91,
                92,
                93,
                94,
                95,
                96,
                97,
                98,
                99,
                100
            ],
            "defaultValue": 2,
            "metadata": {
                "description": "The number of agents for the cluster.  This value can be from 1 to 100"
            },
            "type": "int"
        },
        "agentcontrolEndpointDNSNamePrefix": {
            "metadata": {
                "description": "Sets the Domain name label for the agent pool IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address."
            },
            "type": "string"
        },
        "agentcontrolSubnet": {
            "defaultValue": "10.13.112.32/27",
            "metadata": {
                "description": "Sets the subnet of agent pool 'agentcontrol'."
            },
            "type": "string"
        },
        "agentcontrolVMSize": {
            "allowedValues": [
                "Standard_F1",
                "Standard_F2",
                "Standard_F4",
                "Standard_F8",
                "Standard_F16"
            ],
            "defaultValue": "Standard_F4",
            "metadata": {
                "description": "The size of the Virtual Machine."
            },
            "type": "string"
        },
        "agentproxyCount": {
            "allowedValues": [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16,
                17,
                18,
                19,
                20,
                21,
                22,
                23,
                24,
                25,
                26,
                27,
                28,
                29,
                30,
                31,
                32,
                33,
                34,
                35,
                36,
                37,
                38,
                39,
                40,
                41,
                42,
                43,
                44,
                45,
                46,
                47,
                48,
                49,
                50,
                51,
                52,
                53,
                54,
                55,
                56,
                57,
                58,
                59,
                60,
                61,
                62,
                63,
                64,
                65,
                66,
                67,
                68,
                69,
                70,
                71,
                72,
                73,
                74,
                75,
                76,
                77,
                78,
                79,
                80,
                81,
                82,
                83,
                84,
                85,
                86,
                87,
                88,
                89,
                90,
                91,
                92,
                93,
                94,
                95,
                96,
                97,
                98,
                99,
                100
            ],
            "defaultValue": 2,
            "metadata": {
                "description": "The number of agents for the cluster.  This value can be from 1 to 100"
            },
            "type": "int"
        },
        "agentproxyEndpointDNSNamePrefix": {
            "metadata": {
                "description": "Sets the Domain name label for the agent pool IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address."
            },
            "type": "string"
        },
        "agentproxySubnet": {
            "defaultValue": "10.13.112.1/27",
            "metadata": {
                "description": "Sets the subnet of agent pool 'agentproxy'."
            },
            "type": "string"
        },
        "agentproxyVMSize": {
            "allowedValues": [
                "Standard_F1",
                "Standard_F2",
                "Standard_F4",
                "Standard_F8",
                "Standard_F16"
            ],
            "defaultValue": "Standard_F4",
            "metadata": {
                "description": "The size of the Virtual Machine."
            },
            "type": "string"
        },
        "agentworkerCount": {
            "allowedValues": [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16,
                17,
                18,
                19,
                20,
                21,
                22,
                23,
                24,
                25,
                26,
                27,
                28,
                29,
                30,
                31,
                32,
                33,
                34,
                35,
                36,
                37,
                38,
                39,
                40,
                41,
                42,
                43,
                44,
                45,
                46,
                47,
                48,
                49,
                50,
                51,
                52,
                53,
                54,
                55,
                56,
                57,
                58,
                59,
                60,
                61,
                62,
                63,
                64,
                65,
                66,
                67,
                68,
                69,
                70,
                71,
                72,
                73,
                74,
                75,
                76,
                77,
                78,
                79,
                80,
                81,
                82,
                83,
                84,
                85,
                86,
                87,
                88,
                89,
                90,
                91,
                92,
                93,
                94,
                95,
                96,
                97,
                98,
                99,
                100
            ],
            "defaultValue": 5,
            "metadata": {
                "description": "The number of agents for the cluster.  This value can be from 1 to 100"
            },
            "type": "int"
        },
        "agentworkerEndpointDNSNamePrefix": {
            "metadata": {
                "description": "Sets the Domain name label for the agent pool IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address."
            },
            "type": "string"
        },
        "agentworkerSubnet": {
            "defaultValue": "10.13.112.64/27",
            "metadata": {
                "description": "Sets the subnet of agent pool 'agentworker'."
            },
            "type": "string"
        },
        "agentworkerVMSize": {
            "allowedValues": [
                "Standard_F1",
                "Standard_F2",
                "Standard_F4",
                "Standard_F8",
                "Standard_F16",
                "Standard_D5_v2"
            ],
            "defaultValue": "Standard_F4",
            "metadata": {
                "description": "The size of the Virtual Machine."
            },
            "type": "string"
        },
        "agentworkeraetherCount": {
            "allowedValues": [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16,
                17,
                18,
                19,
                20,
                21,
                22,
                23,
                24,
                25,
                26,
                27,
                28,
                29,
                30,
                31,
                32,
                33,
                34,
                35,
                36,
                37,
                38,
                39,
                40,
                41,
                42,
                43,
                44,
                45,
                46,
                47,
                48,
                49,
                50,
                51,
                52,
                53,
                54,
                55,
                56,
                57,
                58,
                59,
                60,
                61,
                62,
                63,
                64,
                65,
                66,
                67,
                68,
                69,
                70,
                71,
                72,
                73,
                74,
                75,
                76,
                77,
                78,
                79,
                80,
                81,
                82,
                83,
                84,
                85,
                86,
                87,
                88,
                89,
                90,
                91,
                92,
                93,
                94,
                95,
                96,
                97,
                98,
                99,
                100
            ],
            "defaultValue": 5,
            "metadata": {
                "description": "The number of agents for the cluster.  This value can be from 1 to 100"
            },
            "type": "int"
        },
        "agentworkeraetherEndpointDNSNamePrefix": {
            "metadata": {
                "description": "Sets the Domain name label for the agent pool IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address."
            },
            "type": "string"
        },
        "agentworkeraetherSubnet": {
            "defaultValue": "10.13.110.0/23",
            "metadata": {
                "description": "Sets the subnet of agent pool 'agentworker'."
            },
            "type": "string"
        },
        "agentworkeraetherVMSize": {
            "allowedValues": [
                "Standard_F1",
                "Standard_F2",
                "Standard_F4",
                "Standard_F8",
                "Standard_F16",
                "Standard_D5_v2"
            ],
            "defaultValue": "Standard_D5_v2",
            "metadata": {
                "description": "The size of the Virtual Machine."
            },
            "type": "string"
        },
        "firstConsecutiveStaticIP": {
            "defaultValue": "172.16.0.5",
            "metadata": {
                "description": "Sets the static IP of the first master"
            },
            "type": "string"
        },
        "linuxAdminUsername": {
            "defaultValue": "core",
            "metadata": {
                "description": "User name for the Linux Virtual Machines (SSH or Password)."
            },
            "type": "string"
        },
        "masterEndpointDNSNamePrefix": {
            "metadata": {
                "description": "Sets the Domain name label for the master IP Address.  The concatenation of the domain name label and the regional DNS zone make up the fully qualified domain name associated with the public IP address."
            },
            "type": "string"
        },
        "masterSubnet": {
            "defaultValue": "172.16.0.0/24",
            "metadata": {
                "description": "Sets the subnet of the master node(s)."
            },
            "type": "string"
        },
        "masterVMSize": {
            "allowedValues": [
                "Standard_F1",
                "Standard_F2",
                "Standard_F4",
                "Standard_F8",
                "Standard_F16"
            ],
            "defaultValue": "Standard_F4",
            "metadata": {
                "description": "The size of the Virtual Machine."
            },
            "type": "string"
        },
        "nameSuffix": {
            "defaultValue": "11111111",
            "metadata": {
                "description": "A string hash of the master DNS name to uniquely identify the cluster."
            },
            "type": "string"
        },
        "sshRSAPublicKey": {
            "metadata": {
                "description": "SSH public key used for auth to all Linux machines.  Not Required.  If not set, you must provide a password key."
            },
            "type": "string"
        }
    },
    "resources": [
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentworkerNSGName')]",
            "properties": {
                "securityRules": []
            },
            "type": "Microsoft.Network/networkSecurityGroups"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentworkeraetherNSGName')]",
            "properties": {
                "securityRules": []
            },
            "type": "Microsoft.Network/networkSecurityGroups"
        },
        {
            "apiVersion": "[variables('apiVersionStorage')]",
            "copy": {
                "count": "[variables('agentworkerStorageAccountsCount')]",
                "name": "loop"
            },
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('storageAccountPrefixes')[mod(add(copyIndex(),variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(copyIndex(),variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName'))]",
            "properties": {
                "accountType": "[variables('vmSizesMap')[variables('agentworkerVMSize')].storageAccountType]"
            },
            "type": "Microsoft.Storage/storageAccounts"
        },
        {
            "apiVersion": "[variables('apiVersionStorage')]",
            "copy": {
                "count": "[variables('agentworkeraetherStorageAccountsCount')]",
                "name": "loop"
            },
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('storageAccountPrefixes')[mod(add(copyIndex(),variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(copyIndex(),variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName'))]",
            "properties": {
                "accountType": "[variables('vmSizesMap')[variables('agentworkeraetherVMSize')].storageAccountType]"
            },
            "type": "Microsoft.Storage/storageAccounts"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentworkerIPAddressName')]",
            "properties": {
                "dnsSettings": {
                    "domainNameLabel": "[variables('agentworkerEndpointDNSNamePrefix')]"
                },
                "publicIPAllocationMethod": "Dynamic"
            },
            "type": "Microsoft.Network/publicIPAddresses"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentworkeraetherIPAddressName')]",
            "properties": {
                "dnsSettings": {
                    "domainNameLabel": "[variables('agentworkeraetherEndpointDNSNamePrefix')]"
                },
                "publicIPAllocationMethod": "Dynamic"
            },
            "type": "Microsoft.Network/publicIPAddresses"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('agentworkerIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('agentworkerLbName')]",
            "properties": {
                "backendAddressPools": [
                    {
                        "name": "[variables('agentworkerLbBackendPoolName')]"
                    }
                ],
                "frontendIPConfigurations": [
                    {
                        "name": "[variables('agentworkerLbIPConfigName')]",
                        "properties": {
                            "publicIPAddress": {
                                "id": "[resourceId('Microsoft.Network/publicIPAddresses',variables('agentworkerIPAddressName'))]"
                            }
                        }
                    }
                ],
                "inboundNatRules": [],
                "loadBalancingRules": [],
                "probes": []
            },
            "type": "Microsoft.Network/loadBalancers"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('agentworkeraetherIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('agentworkeraetherLbName')]",
            "properties": {
                "backendAddressPools": [
                    {
                        "name": "[variables('agentworkeraetherLbBackendPoolName')]"
                    }
                ],
                "frontendIPConfigurations": [
                    {
                        "name": "[variables('agentworkeraetherLbIPConfigName')]",
                        "properties": {
                            "publicIPAddress": {
                                "id": "[resourceId('Microsoft.Network/publicIPAddresses',variables('agentworkeraetherIPAddressName'))]"
                            }
                        }
                    }
                ],
                "inboundNatRules": [],
                "loadBalancingRules": [],
                "probes": []
            },
            "type": "Microsoft.Network/loadBalancers"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[variables('vnetID')]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName'))]",
                "[concat('Microsoft.Network/loadBalancers/', variables('agentworkerLbName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('agentworkerVMNamePrefix'), '-vmss')]",
            "properties": {
                "upgradePolicy": {
                    "mode": "Manual"
                },
                "virtualMachineProfile": {
                    "networkProfile": {
                        "networkInterfaceConfigurations": [
                            {
                                "name": "nic",
                                "properties": {
                                    "ipConfigurations": [
                                        {
                                            "name": "nicipconfig",
                                            "properties": {
                                                "loadBalancerBackendAddressPools": [
                                                    {
                                                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('agentworkerLbName'), '/backendAddressPools/',variables('agentworkerLbBackendPoolName'))]"
                                                    }
                                                ],
                                                "subnet": {
                                                    "id": "[variables('agentworkerVnetSubnetID')]"
                                                }
                                            }
                                        }
                                    ],
                                    "primary": "true"
                                }
                            }
                        ]
                    },
                    "osProfile": {
                        "adminUsername": "[variables('adminUsername')]",
                        "computerNamePrefix": "[variables('agentworkerVMNamePrefix')]",
                        "customData": "[base64(concat('{\"networkd\":{},\"systemd\":{\"units\":[{\"dropins\":[{\"name\":\"11-docker-namespaces.conf\",\"contents\":\"[Service]\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo touch /etc/subuid /etc/subgid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subuid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subgid\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; /usr/bin/systemctl set-environment DOCKER_OPTS=--userns-remap=default\\\"\\u000A\"}],\"enable\":true,\"name\":\"docker.service\"},{\"enable\":true,\"name\":\"ethos-files.service\",\"contents\":\"[Unit]\\u000ADescription=Ethos Setup: Custom Files\\u000AAfter=network-online.target\\u000A[Service]\\u000AType=oneshot\\u000ARemainAfterExit=yes\\u000AExecStartPre=/bin/mkdir -p /var/lib/dcos\\u000AExecStartPre=/usr/bin/bash -c \\\"/bin/echo MESOS_ATTRIBUTES=ethos_role:worker\\u005c;zone:',resourceGroup().location,' \\u003e /var/lib/dcos/mesos-slave-common\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo setenforce 1 \\u0026\\u0026 sudo cp --remove-destination $(readlink -f /etc/selinux/config) /etc/selinux/config \\u0026\\u0026 sudo sed -i.bak \\\"s/SELINUX=permissive/SELINUX=enforcing/g\\\" /etc/selinux/config\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; if [[ $(mount | grep xen) ]]; then sudo umount /proc/xen; fi\\\"\\u000AExecStart=/bin/bash -c \\\"exit 0\\\"\\u000A[Install]\\u000AWantedBy=multi-user.target\\u000A\"},{\"dropins\":[{\"name\":\"08-dcos-adminrouter-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/adminrouter.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000A\"}],\"name\":\"dcos-adminrouter.service\"},{\"dropins\":[{\"name\":\"08-dcos-oauth-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/proxy.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000AEnvironment=OAUTH_ISSUER_URL=https://ethos-platform.auth0.com/\\u000A\"},{\"name\":\"09-dcos-oauth-ldap.conf\",\"contents\":\"[Service]\\u000AEnvironment=OAUTH_ALLOW_LOCAL_USERS=false\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER=\\\"\\\"\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER_HASH=\\\"\\\"\\u000AEnvironment=OAUTH_ALLOW_LDAP_USERS=false\\u000AEnvironment=OAUTH_LDAP_WHITELIST_ONLY=false\\u000A\"},{\"name\":\"11-dcos-oauth-ethos-binary.conf\",\"contents\":\"[Service]\\u000AExecStart=\\u000AExecStart=/opt/ethos/bin/dcos-oauth serve --addr=127.0.0.1:8101 --zk-addr=127.0.0.1:2181 --secret-key-path=/var/lib/dcos/dcos-oauth/auth-token-secret --segment-key=51ybGTeFEFU1xo6u10XMDrr6kATFyRyh\\u000A\"}],\"name\":\"dcos-oauth.service\"}]},\"storage\":{\"files\":[{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/sssd/sssd.conf\",\"contents\":{\"source\":\"data:,%5Bsssd%5D%0Aconfig_file_version%20%3D%202%0Aservices%20%3D%20nss%2C%20pam%2C%20ssh%0Adomains%20%3D%20LDAP%0A%5Bdomain%2FLDAP%5D%0Aldap_id_use_start_tls%20%3D%20true%0Aldap_schema%20%3D%20rfc2307bis%0Aldap_search_base%20%3D%20o%3Dadbe%0Aid_provider%20%3D%20ldap%0Aauth_provider%20%3D%20ldap%0Achpass_provider%20%3D%20ldap%0Aldap_uri%20%3D%20ldap%3A%2F%2Fldap.loc.adobe.net%3A389%0Acache_credentials%20%3D%20true%0Aldap_tls_cacert%20%3D%20%2Fetc%2Fssl%2Fcerts%2Fca-certificates.crt%0Aldap_tls_reqcert%20%3D%20demand%0Aldap_group_member%20%3D%20uniqueMember%0Aldap_user_ssh_public_key%20%3D%20sshPublicKey%0Aaccess_provider%20%3D%20simple%0Asimple_allow_groups%20%3D%20CST%2CCPT%2CNetServ_NetOps%2CSST%0A%5Bnss%5D%0Adefault_shell%20%3D%20%2Fbin%2Fbash%0Afilter_users%20%3D%20core%2Croot%0A\",\"verification\":{}},\"mode\":384},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/coreos/update.conf\",\"contents\":{\"source\":\"data:,REBOOT_STRATEGY%3Doff%0AGROUP%3Dstable%0ASERVER%3Dhttps%3A%2F%2Fpublic.update.core-os.net%2Fv1%2Fupdate%2F%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/repository-url\",\"contents\":{\"source\":\"data:,https%3A%2F%2Fdcosio.azureedge.net%2Fdcos%2Fstable\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/bootstrap-id\",\"contents\":{\"source\":\"data:,BOOTSTRAP_ID%3D5df43052907c021eeb5de145419a3da1898c58a5\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/cluster-packages.json\",\"contents\":{\"source\":\"data:,%5B%22dcos-config--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%2C%22dcos-metadata--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/rexray/config.yml\",\"contents\":{\"source\":\"data:,rexray%3A%0A%20%20loglevel%3A%20info%0A%20%20modules%3A%0A%20%20%20%20default-admin%3A%0A%20%20%20%20%20%20host%3A%20tcp%3A%2F%2F127.0.0.1%3A61003%0A%20%20%20%20default-docker%3A%0A%20%20%20%20%20%20disabled%3A%20true%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/mesos-master-provider\",\"contents\":{\"source\":\"data:,MESOS_CLUSTER%3D',resourceGroup().name,'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/adminrouter.env\",\"contents\":{\"source\":\"data:,ADMINROUTER_ACTIVATE_AUTH_MODULE%3D',variables('oauthEnabled'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor\",\"contents\":{\"source\":\"data:,EXHIBITOR_BACKEND%3DAZURE%0AAZURE_CONTAINER%3Ddcos-exhibitor%0AAZURE_PREFIX%3D',variables('masterPublicIPAddressName'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/ui-config.json\",\"contents\":{\"source\":\"data:,%7B%22uiConfiguration%22%3A%20%7B%22plugins%22%3A%20%7B%22banner%22%3A%20%7B%22enabled%22%3A%20false%2C%22backgroundColor%22%3A%20%22%231E232F%22%2C%22foregroundColor%22%3A%20%22%23FFFFFF%22%2C%22headerTitle%22%3A%20null%2C%22headerContent%22%3A%20null%2C%22footerContent%22%3A%20null%2C%22imagePath%22%3A%20null%2C%22dismissible%22%3A%20null%7D%2C%22branding%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22external-links%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22authentication%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22oauth%22%3A%20%7B%22enabled%22%3A%20',variables('oauthEnabled'),'%2C%22authHost%22%3A%20%22https://ethos-platform.auth0.com%22%7D%2C%22tracking%22%3A%20%7B%22enabled%22%3A%20false%7D%7D%7D%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/pkginfo.json\",\"contents\":{\"source\":\"data:,%7B%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure_slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/auth.env\",\"contents\":{\"source\":\"data:,SEED%3Da849kd2nb3laqp485nnf75jk1oou%0AROLE%3Dslave%0ASERVICES%3D%22mesos-agent,metronome,marathon,ethos-services,chronos,etcd,booster,spark,hdfs,kafka%22%0A\",\"verification\":{}},\"mode\":256},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/ldap.toml\",\"contents\":{\"source\":\"data:,%5Bserver%5D%0Ahost%20%3D%20%22ldap.loc.adobe.net%22%0Aport%20%3D%20636%0Ause_ssl%20%3D%20true%0Assl_skip_verify%20%3D%20false%0Abind_dn%20%3D%20%22cn%3D%25s%2Cou%3DUsers%2Co%3Dadbe%22%0Asearch_filter%20%3D%20%22(cn%3D%25s)%22%0Asearch_base_dns%20%3D%20%5B%22ou%3DUsers%2Co%3Dadbe%22%5D%0Adefault_role%20%3D%20%22%22%0A%5Bserver.attributes%5D%0Aname%20%3D%20%22givenName%22%0Asurname%20%3D%20%22sn%22%0Ausername%20%3D%20%22cn%22%0Amember_of%20%3D%20%22memberOf%22%0Aemail%20%3D%20%20%22mail%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DCST%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DHA_team%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/master_list\",\"contents\":{\"source\":\"data:,%5B%22',reference(variables('masterVMNic')[0]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[1]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[2]).ipConfigurations[0].properties.privateIPAddress,'%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor.properties\",\"contents\":{\"source\":\"data:,com.netflix.exhibitor.azure.account-name%3D',variables('masterStorageAccountExhibitorName'),'%0Acom.netflix.exhibitor.azure.account-key%3D',listKeys(resourceId('Microsoft.Storage/storageAccounts',variables('masterStorageAccountExhibitorName')),'2015-06-15').key1,'\",\"verification\":{}},\"mode\":420}]},\"ignition\":{\"version\":\"2.0.0\",\"config\":{\"append\":[{\"source\":\"https://git.corp.adobe.com/raw/animjain/dcos-infrastructure-aetherchanges-egressrules/master/bootstrap/ignition-remote.json?token=AAA--fwrQ2omtmLAsRNHBRgB9ntf69Uoks5Yvo3FwA%3D%3D\",\"verification\":{}}]}}}'))]",
                        "linuxConfiguration": {
                            "disablePasswordAuthentication": "true",
                            "ssh": {
                                "publicKeys": [
                                    {
                                        "keyData": "[parameters('sshRSAPublicKey')]",
                                        "path": "[variables('sshKeyPath')]"
                                    }
                                ]
                            }
                        }
                    },
                    "storageProfile": {
                        "imageReference": {
                            "offer": "[variables('osImageOffer')]",
                            "publisher": "[variables('osImagePublisher')]",
                            "sku": "[variables('osImageSKU')]",
                            "version": "[variables('osImageVersion')]"
                        },
                        "osDisk": {
                            "caching": "ReadOnly",
                            "createOption": "FromImage",
                            "name": "vmssosdisk",
                            "vhdContainers": [
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentworkerStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkerAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]"
                            ]
                        }
                    }
                }
            },
            "sku": {
                "capacity": "[variables('agentworkerCount')]",
                "name": "[variables('agentworkerVMSize')]",
                "tier": "Standard"
            },
            "tags": {
                "creationSource": "[concat('acsengine-', variables('agentworkerVMNamePrefix'), '-vmss')]"
            },
            "type": "Microsoft.Compute/virtualMachineScaleSets"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[variables('vnetID')]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName'))]",
                "[concat('Microsoft.Network/loadBalancers/', variables('agentworkeraetherLbName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('agentworkeraetherVMNamePrefix'), '-vmss')]",
            "properties": {
                "upgradePolicy": {
                    "mode": "Manual"
                },
                "virtualMachineProfile": {
                    "networkProfile": {
                        "networkInterfaceConfigurations": [
                            {
                                "name": "nic",
                                "properties": {
                                    "ipConfigurations": [
                                        {
                                            "name": "nicipconfig",
                                            "properties": {
                                                "loadBalancerBackendAddressPools": [
                                                    {
                                                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('agentworkeraetherLbName'), '/backendAddressPools/',variables('agentworkeraetherLbBackendPoolName'))]"
                                                    }
                                                ],
                                                "subnet": {
                                                    "id": "[variables('agentworkeraetherVnetSubnetID')]"
                                                }
                                            }
                                        }
                                    ],
                                    "primary": "true"
                                }
                            }
                        ]
                    },
                    "osProfile": {
                        "adminUsername": "[variables('adminUsername')]",
                        "computerNamePrefix": "[variables('agentworkeraetherVMNamePrefix')]",
                        "customData": "[base64(concat('{\"networkd\":{},\"systemd\":{\"units\":[{\"dropins\":[{\"name\":\"11-docker-namespaces.conf\",\"contents\":\"[Service]\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo touch /etc/subuid /etc/subgid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subuid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subgid\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; /usr/bin/systemctl set-environment DOCKER_OPTS=--userns-remap=default\\\"\\u000A\"}],\"enable\":true,\"name\":\"docker.service\"},{\"enable\":true,\"name\":\"ethos-files.service\",\"contents\":\"[Unit]\\u000ADescription=Ethos Setup: Custom Files\\u000AAfter=network-online.target\\u000A[Service]\\u000AType=oneshot\\u000ARemainAfterExit=yes\\u000AExecStartPre=/bin/mkdir -p /var/lib/dcos\\u000AExecStartPre=/usr/bin/bash -c \\\"/bin/echo MESOS_ATTRIBUTES=ethos_role:workeraether\\u005c;zone:',resourceGroup().location,' \\u003e /var/lib/dcos/mesos-slave-common\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo setenforce 1 \\u0026\\u0026 sudo cp --remove-destination $(readlink -f /etc/selinux/config) /etc/selinux/config \\u0026\\u0026 sudo sed -i.bak \\\"s/SELINUX=permissive/SELINUX=enforcing/g\\\" /etc/selinux/config\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; if [[ $(mount | grep xen) ]]; then sudo umount /proc/xen; fi\\\"\\u000AExecStart=/bin/bash -c \\\"exit 0\\\"\\u000A[Install]\\u000AWantedBy=multi-user.target\\u000A\"},{\"dropins\":[{\"name\":\"08-dcos-adminrouter-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/adminrouter.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000A\"}],\"name\":\"dcos-adminrouter.service\"},{\"dropins\":[{\"name\":\"08-dcos-oauth-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/proxy.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000AEnvironment=OAUTH_ISSUER_URL=https://ethos-platform.auth0.com/\\u000A\"},{\"name\":\"09-dcos-oauth-ldap.conf\",\"contents\":\"[Service]\\u000AEnvironment=OAUTH_ALLOW_LOCAL_USERS=false\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER=\\\"\\\"\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER_HASH=\\\"\\\"\\u000AEnvironment=OAUTH_ALLOW_LDAP_USERS=false\\u000AEnvironment=OAUTH_LDAP_WHITELIST_ONLY=false\\u000A\"},{\"name\":\"11-dcos-oauth-ethos-binary.conf\",\"contents\":\"[Service]\\u000AExecStart=\\u000AExecStart=/opt/ethos/bin/dcos-oauth serve --addr=127.0.0.1:8101 --zk-addr=127.0.0.1:2181 --secret-key-path=/var/lib/dcos/dcos-oauth/auth-token-secret --segment-key=51ybGTeFEFU1xo6u10XMDrr6kATFyRyh\\u000A\"}],\"name\":\"dcos-oauth.service\"}]},\"storage\":{\"files\":[{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/sssd/sssd.conf\",\"contents\":{\"source\":\"data:,%5Bsssd%5D%0Aconfig_file_version%20%3D%202%0Aservices%20%3D%20nss%2C%20pam%2C%20ssh%0Adomains%20%3D%20LDAP%0A%5Bdomain%2FLDAP%5D%0Aldap_id_use_start_tls%20%3D%20true%0Aldap_schema%20%3D%20rfc2307bis%0Aldap_search_base%20%3D%20o%3Dadbe%0Aid_provider%20%3D%20ldap%0Aauth_provider%20%3D%20ldap%0Achpass_provider%20%3D%20ldap%0Aldap_uri%20%3D%20ldap%3A%2F%2Fldap.loc.adobe.net%3A389%0Acache_credentials%20%3D%20true%0Aldap_tls_cacert%20%3D%20%2Fetc%2Fssl%2Fcerts%2Fca-certificates.crt%0Aldap_tls_reqcert%20%3D%20demand%0Aldap_group_member%20%3D%20uniqueMember%0Aldap_user_ssh_public_key%20%3D%20sshPublicKey%0Aaccess_provider%20%3D%20simple%0Asimple_allow_groups%20%3D%20CST%2CCPT%2CNetServ_NetOps%2CSST%0A%5Bnss%5D%0Adefault_shell%20%3D%20%2Fbin%2Fbash%0Afilter_users%20%3D%20core%2Croot%0A\",\"verification\":{}},\"mode\":384},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/coreos/update.conf\",\"contents\":{\"source\":\"data:,REBOOT_STRATEGY%3Doff%0AGROUP%3Dstable%0ASERVER%3Dhttps%3A%2F%2Fpublic.update.core-os.net%2Fv1%2Fupdate%2F%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/repository-url\",\"contents\":{\"source\":\"data:,https%3A%2F%2Fdcosio.azureedge.net%2Fdcos%2Fstable\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/bootstrap-id\",\"contents\":{\"source\":\"data:,BOOTSTRAP_ID%3D5df43052907c021eeb5de145419a3da1898c58a5\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/cluster-packages.json\",\"contents\":{\"source\":\"data:,%5B%22dcos-config--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%2C%22dcos-metadata--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/rexray/config.yml\",\"contents\":{\"source\":\"data:,rexray%3A%0A%20%20loglevel%3A%20info%0A%20%20modules%3A%0A%20%20%20%20default-admin%3A%0A%20%20%20%20%20%20host%3A%20tcp%3A%2F%2F127.0.0.1%3A61003%0A%20%20%20%20default-docker%3A%0A%20%20%20%20%20%20disabled%3A%20true%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/mesos-master-provider\",\"contents\":{\"source\":\"data:,MESOS_CLUSTER%3D',resourceGroup().name,'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/adminrouter.env\",\"contents\":{\"source\":\"data:,ADMINROUTER_ACTIVATE_AUTH_MODULE%3D',variables('oauthEnabled'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor\",\"contents\":{\"source\":\"data:,EXHIBITOR_BACKEND%3DAZURE%0AAZURE_CONTAINER%3Ddcos-exhibitor%0AAZURE_PREFIX%3D',variables('masterPublicIPAddressName'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/ui-config.json\",\"contents\":{\"source\":\"data:,%7B%22uiConfiguration%22%3A%20%7B%22plugins%22%3A%20%7B%22banner%22%3A%20%7B%22enabled%22%3A%20false%2C%22backgroundColor%22%3A%20%22%231E232F%22%2C%22foregroundColor%22%3A%20%22%23FFFFFF%22%2C%22headerTitle%22%3A%20null%2C%22headerContent%22%3A%20null%2C%22footerContent%22%3A%20null%2C%22imagePath%22%3A%20null%2C%22dismissible%22%3A%20null%7D%2C%22branding%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22external-links%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22authentication%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22oauth%22%3A%20%7B%22enabled%22%3A%20',variables('oauthEnabled'),'%2C%22authHost%22%3A%20%22https://ethos-platform.auth0.com%22%7D%2C%22tracking%22%3A%20%7B%22enabled%22%3A%20false%7D%7D%7D%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/pkginfo.json\",\"contents\":{\"source\":\"data:,%7B%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure_slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/auth.env\",\"contents\":{\"source\":\"data:,SEED%3Da849kd2nb3laqp485nnf75jk1oou%0AROLE%3Dslave%0ASERVICES%3D%22mesos-agent,metronome,marathon,ethos-services,chronos,etcd,booster,spark,hdfs,kafka%22%0A\",\"verification\":{}},\"mode\":256},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/ldap.toml\",\"contents\":{\"source\":\"data:,%5Bserver%5D%0Ahost%20%3D%20%22ldap.loc.adobe.net%22%0Aport%20%3D%20636%0Ause_ssl%20%3D%20true%0Assl_skip_verify%20%3D%20false%0Abind_dn%20%3D%20%22cn%3D%25s%2Cou%3DUsers%2Co%3Dadbe%22%0Asearch_filter%20%3D%20%22(cn%3D%25s)%22%0Asearch_base_dns%20%3D%20%5B%22ou%3DUsers%2Co%3Dadbe%22%5D%0Adefault_role%20%3D%20%22%22%0A%5Bserver.attributes%5D%0Aname%20%3D%20%22givenName%22%0Asurname%20%3D%20%22sn%22%0Ausername%20%3D%20%22cn%22%0Amember_of%20%3D%20%22memberOf%22%0Aemail%20%3D%20%20%22mail%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DCST%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DHA_team%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/master_list\",\"contents\":{\"source\":\"data:,%5B%22',reference(variables('masterVMNic')[0]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[1]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[2]).ipConfigurations[0].properties.privateIPAddress,'%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor.properties\",\"contents\":{\"source\":\"data:,com.netflix.exhibitor.azure.account-name%3D',variables('masterStorageAccountExhibitorName'),'%0Acom.netflix.exhibitor.azure.account-key%3D',listKeys(resourceId('Microsoft.Storage/storageAccounts',variables('masterStorageAccountExhibitorName')),'2015-06-15').key1,'\",\"verification\":{}},\"mode\":420}]},\"ignition\":{\"version\":\"2.0.0\",\"config\":{\"append\":[{\"source\":\"https://git.corp.adobe.com/raw/animjain/dcos-infrastructure-aetherchanges-egressrules/master/bootstrap/ignition-remote.json?token=AAA--fwrQ2omtmLAsRNHBRgB9ntf69Uoks5Yvo3FwA%3D%3D\",\"verification\":{}}]}}}'))]",
                        "linuxConfiguration": {
                            "disablePasswordAuthentication": "true",
                            "ssh": {
                                "publicKeys": [
                                    {
                                        "keyData": "[parameters('sshRSAPublicKey')]",
                                        "path": "[variables('sshKeyPath')]"
                                    }
                                ]
                            }
                        }
                    },
                    "storageProfile": {
                        "imageReference": {
                            "offer": "[variables('osImageOffer')]",
                            "publisher": "[variables('osImagePublisher')]",
                            "sku": "[variables('osImageSKU')]",
                            "version": "[variables('osImageVersion')]"
                        },
                        "osDisk": {
                            "caching": "ReadOnly",
                            "createOption": "FromImage",
                            "name": "vmssosdisk",
                            "vhdContainers": [
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentworkeraetherStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentworkeraetherAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]"
                            ]
                        }
                    }
                }
            },
            "sku": {
                "capacity": "[variables('agentworkeraetherCount')]",
                "name": "[variables('agentworkeraetherVMSize')]",
                "tier": "Standard"
            },
            "tags": {
                "creationSource": "[concat('acsengine-', variables('agentworkeraetherVMNamePrefix'), '-vmss')]"
            },
            "type": "Microsoft.Compute/virtualMachineScaleSets"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentcontrolNSGName')]",
            "properties": {
                "securityRules": []
            },
            "type": "Microsoft.Network/networkSecurityGroups"
        },
        {
            "apiVersion": "[variables('apiVersionStorage')]",
            "copy": {
                "count": "[variables('agentcontrolStorageAccountsCount')]",
                "name": "loop"
            },
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('storageAccountPrefixes')[mod(add(copyIndex(),variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(copyIndex(),variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName'))]",
            "properties": {
                "accountType": "[variables('vmSizesMap')[variables('agentcontrolVMSize')].storageAccountType]"
            },
            "type": "Microsoft.Storage/storageAccounts"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentcontrolIPAddressName')]",
            "properties": {
                "dnsSettings": {
                    "domainNameLabel": "[variables('agentcontrolEndpointDNSNamePrefix')]"
                },
                "publicIPAllocationMethod": "Dynamic"
            },
            "type": "Microsoft.Network/publicIPAddresses"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('agentcontrolIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('agentcontrolLbName')]",
            "properties": {
                "backendAddressPools": [
                    {
                        "name": "[variables('agentcontrolLbBackendPoolName')]"
                    }
                ],
                "frontendIPConfigurations": [
                    {
                        "name": "[variables('agentcontrolLbIPConfigName')]",
                        "properties": {
                            "publicIPAddress": {
                                "id": "[resourceId('Microsoft.Network/publicIPAddresses',variables('agentcontrolIPAddressName'))]"
                            }
                        }
                    }
                ],
                "inboundNatRules": [],
                "loadBalancingRules": [],
                "probes": []
            },
            "type": "Microsoft.Network/loadBalancers"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[variables('vnetID')]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName'))]",
                "[concat('Microsoft.Network/loadBalancers/', variables('agentcontrolLbName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('agentcontrolVMNamePrefix'), '-vmss')]",
            "properties": {
                "upgradePolicy": {
                    "mode": "Manual"
                },
                "virtualMachineProfile": {
                    "networkProfile": {
                        "networkInterfaceConfigurations": [
                            {
                                "name": "nic",
                                "properties": {
                                    "ipConfigurations": [
                                        {
                                            "name": "nicipconfig",
                                            "properties": {
                                                "loadBalancerBackendAddressPools": [
                                                    {
                                                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('agentcontrolLbName'), '/backendAddressPools/',variables('agentcontrolLbBackendPoolName'))]"
                                                    }
                                                ],
                                                "subnet": {
                                                    "id": "[variables('agentcontrolVnetSubnetID')]"
                                                }
                                            }
                                        }
                                    ],
                                    "primary": "true"
                                }
                            }
                        ]
                    },
                    "osProfile": {
                        "adminUsername": "[variables('adminUsername')]",
                        "computerNamePrefix": "[variables('agentcontrolVMNamePrefix')]",
                        "customData": "[base64(concat('{\"networkd\":{},\"systemd\":{\"units\":[{\"dropins\":[{\"name\":\"11-docker-namespaces.conf\",\"contents\":\"[Service]\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo touch /etc/subuid /etc/subgid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subuid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subgid\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; /usr/bin/systemctl set-environment DOCKER_OPTS=--userns-remap=default\\\"\\u000A\"}],\"enable\":true,\"name\":\"docker.service\"},{\"enable\":true,\"name\":\"ethos-files.service\",\"contents\":\"[Unit]\\u000ADescription=Ethos Setup: Custom Files\\u000AAfter=network-online.target\\u000A[Service]\\u000AType=oneshot\\u000ARemainAfterExit=yes\\u000AExecStartPre=/bin/mkdir -p /var/lib/dcos\\u000AExecStartPre=/usr/bin/bash -c \\\"/bin/echo MESOS_ATTRIBUTES=ethos_role:control\\u005c;zone:',resourceGroup().location,' \\u003e /var/lib/dcos/mesos-slave-common\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo setenforce 1 \\u0026\\u0026 sudo cp --remove-destination $(readlink -f /etc/selinux/config) /etc/selinux/config \\u0026\\u0026 sudo sed -i.bak \\\"s/SELINUX=permissive/SELINUX=enforcing/g\\\" /etc/selinux/config\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; if [[ $(mount | grep xen) ]]; then sudo umount /proc/xen; fi\\\"\\u000AExecStart=/bin/bash -c \\\"exit 0\\\"\\u000A[Install]\\u000AWantedBy=multi-user.target\\u000A\"},{\"dropins\":[{\"name\":\"08-dcos-adminrouter-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/adminrouter.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000A\"}],\"name\":\"dcos-adminrouter.service\"},{\"dropins\":[{\"name\":\"08-dcos-oauth-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/proxy.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000AEnvironment=OAUTH_ISSUER_URL=https://ethos-platform.auth0.com/\\u000A\"},{\"name\":\"09-dcos-oauth-ldap.conf\",\"contents\":\"[Service]\\u000AEnvironment=OAUTH_ALLOW_LOCAL_USERS=false\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER=\\\"\\\"\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER_HASH=\\\"\\\"\\u000AEnvironment=OAUTH_ALLOW_LDAP_USERS=false\\u000AEnvironment=OAUTH_LDAP_WHITELIST_ONLY=false\\u000A\"},{\"name\":\"11-dcos-oauth-ethos-binary.conf\",\"contents\":\"[Service]\\u000AExecStart=\\u000AExecStart=/opt/ethos/bin/dcos-oauth serve --addr=127.0.0.1:8101 --zk-addr=127.0.0.1:2181 --secret-key-path=/var/lib/dcos/dcos-oauth/auth-token-secret --segment-key=51ybGTeFEFU1xo6u10XMDrr6kATFyRyh\\u000A\"}],\"name\":\"dcos-oauth.service\"}]},\"storage\":{\"files\":[{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/sssd/sssd.conf\",\"contents\":{\"source\":\"data:,%5Bsssd%5D%0Aconfig_file_version%20%3D%202%0Aservices%20%3D%20nss%2C%20pam%2C%20ssh%0Adomains%20%3D%20LDAP%0A%5Bdomain%2FLDAP%5D%0Aldap_id_use_start_tls%20%3D%20true%0Aldap_schema%20%3D%20rfc2307bis%0Aldap_search_base%20%3D%20o%3Dadbe%0Aid_provider%20%3D%20ldap%0Aauth_provider%20%3D%20ldap%0Achpass_provider%20%3D%20ldap%0Aldap_uri%20%3D%20ldap%3A%2F%2Fldap.loc.adobe.net%3A389%0Acache_credentials%20%3D%20true%0Aldap_tls_cacert%20%3D%20%2Fetc%2Fssl%2Fcerts%2Fca-certificates.crt%0Aldap_tls_reqcert%20%3D%20demand%0Aldap_group_member%20%3D%20uniqueMember%0Aldap_user_ssh_public_key%20%3D%20sshPublicKey%0Aaccess_provider%20%3D%20simple%0Asimple_allow_groups%20%3D%20CST%2CCPT%2CNetServ_NetOps%2CSST%0A%5Bnss%5D%0Adefault_shell%20%3D%20%2Fbin%2Fbash%0Afilter_users%20%3D%20core%2Croot%0A\",\"verification\":{}},\"mode\":384},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/coreos/update.conf\",\"contents\":{\"source\":\"data:,REBOOT_STRATEGY%3Doff%0AGROUP%3Dstable%0ASERVER%3Dhttps%3A%2F%2Fpublic.update.core-os.net%2Fv1%2Fupdate%2F%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/repository-url\",\"contents\":{\"source\":\"data:,https%3A%2F%2Fdcosio.azureedge.net%2Fdcos%2Fstable\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/bootstrap-id\",\"contents\":{\"source\":\"data:,BOOTSTRAP_ID%3D5df43052907c021eeb5de145419a3da1898c58a5\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/cluster-packages.json\",\"contents\":{\"source\":\"data:,%5B%22dcos-config--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%2C%22dcos-metadata--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/rexray/config.yml\",\"contents\":{\"source\":\"data:,rexray%3A%0A%20%20loglevel%3A%20info%0A%20%20modules%3A%0A%20%20%20%20default-admin%3A%0A%20%20%20%20%20%20host%3A%20tcp%3A%2F%2F127.0.0.1%3A61003%0A%20%20%20%20default-docker%3A%0A%20%20%20%20%20%20disabled%3A%20true%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/mesos-master-provider\",\"contents\":{\"source\":\"data:,MESOS_CLUSTER%3D',resourceGroup().name,'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/adminrouter.env\",\"contents\":{\"source\":\"data:,ADMINROUTER_ACTIVATE_AUTH_MODULE%3D',variables('oauthEnabled'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor\",\"contents\":{\"source\":\"data:,EXHIBITOR_BACKEND%3DAZURE%0AAZURE_CONTAINER%3Ddcos-exhibitor%0AAZURE_PREFIX%3D',variables('masterPublicIPAddressName'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/ui-config.json\",\"contents\":{\"source\":\"data:,%7B%22uiConfiguration%22%3A%20%7B%22plugins%22%3A%20%7B%22banner%22%3A%20%7B%22enabled%22%3A%20false%2C%22backgroundColor%22%3A%20%22%231E232F%22%2C%22foregroundColor%22%3A%20%22%23FFFFFF%22%2C%22headerTitle%22%3A%20null%2C%22headerContent%22%3A%20null%2C%22footerContent%22%3A%20null%2C%22imagePath%22%3A%20null%2C%22dismissible%22%3A%20null%7D%2C%22branding%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22external-links%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22authentication%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22oauth%22%3A%20%7B%22enabled%22%3A%20',variables('oauthEnabled'),'%2C%22authHost%22%3A%20%22https://ethos-platform.auth0.com%22%7D%2C%22tracking%22%3A%20%7B%22enabled%22%3A%20false%7D%7D%7D%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/pkginfo.json\",\"contents\":{\"source\":\"data:,%7B%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure_slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/auth.env\",\"contents\":{\"source\":\"data:,SEED%3Da849kd2nb3laqp485nnf75jk1oou%0AROLE%3Dslave%0ASERVICES%3D%22mesos-agent,metronome,marathon,ethos-services,chronos,etcd,booster,spark,hdfs,kafka%22%0A\",\"verification\":{}},\"mode\":256},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/ldap.toml\",\"contents\":{\"source\":\"data:,%5Bserver%5D%0Ahost%20%3D%20%22ldap.loc.adobe.net%22%0Aport%20%3D%20636%0Ause_ssl%20%3D%20true%0Assl_skip_verify%20%3D%20false%0Abind_dn%20%3D%20%22cn%3D%25s%2Cou%3DUsers%2Co%3Dadbe%22%0Asearch_filter%20%3D%20%22(cn%3D%25s)%22%0Asearch_base_dns%20%3D%20%5B%22ou%3DUsers%2Co%3Dadbe%22%5D%0Adefault_role%20%3D%20%22%22%0A%5Bserver.attributes%5D%0Aname%20%3D%20%22givenName%22%0Asurname%20%3D%20%22sn%22%0Ausername%20%3D%20%22cn%22%0Amember_of%20%3D%20%22memberOf%22%0Aemail%20%3D%20%20%22mail%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DCST%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DHA_team%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/master_list\",\"contents\":{\"source\":\"data:,%5B%22',reference(variables('masterVMNic')[0]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[1]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[2]).ipConfigurations[0].properties.privateIPAddress,'%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor.properties\",\"contents\":{\"source\":\"data:,com.netflix.exhibitor.azure.account-name%3D',variables('masterStorageAccountExhibitorName'),'%0Acom.netflix.exhibitor.azure.account-key%3D',listKeys(resourceId('Microsoft.Storage/storageAccounts',variables('masterStorageAccountExhibitorName')),'2015-06-15').key1,'\",\"verification\":{}},\"mode\":420}]},\"ignition\":{\"version\":\"2.0.0\",\"config\":{\"append\":[{\"source\":\"https://git.corp.adobe.com/raw/animjain/dcos-infrastructure-aetherchanges-egressrules/master/bootstrap/ignition-remote.json?token=AAA--fwrQ2omtmLAsRNHBRgB9ntf69Uoks5Yvo3FwA%3D%3D\",\"verification\":{}}]}}}'))]",
                        "linuxConfiguration": {
                            "disablePasswordAuthentication": "true",
                            "ssh": {
                                "publicKeys": [
                                    {
                                        "keyData": "[parameters('sshRSAPublicKey')]",
                                        "path": "[variables('sshKeyPath')]"
                                    }
                                ]
                            }
                        }
                    },
                    "storageProfile": {
                        "imageReference": {
                            "offer": "[variables('osImageOffer')]",
                            "publisher": "[variables('osImagePublisher')]",
                            "sku": "[variables('osImageSKU')]",
                            "version": "[variables('osImageVersion')]"
                        },
                        "osDisk": {
                            "caching": "ReadOnly",
                            "createOption": "FromImage",
                            "name": "vmssosdisk",
                            "vhdContainers": [
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentcontrolStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentcontrolAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]"
                            ]
                        }
                    }
                }
            },
            "sku": {
                "capacity": "[variables('agentcontrolCount')]",
                "name": "[variables('agentcontrolVMSize')]",
                "tier": "Standard"
            },
            "tags": {
                "creationSource": "[concat('acsengine-', variables('agentcontrolVMNamePrefix'), '-vmss')]"
            },
            "type": "Microsoft.Compute/virtualMachineScaleSets"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentproxyNSGName')]",
            "properties": {
                "securityRules": [
                    {
                        "name": "adobe_netblock_aws_sin3_1_300",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock aws_sin3_1 300",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 300,
                            "protocol": "*",
                            "sourceAddressPrefix": "46.137.252.0/28",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_aws_sin3_2_301",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock aws_sin3_2 301",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 301,
                            "protocol": "*",
                            "sourceAddressPrefix": "46.137.252.16/30",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sc_aws_1_302",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sc_aws_1 302",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 302,
                            "protocol": "*",
                            "sourceAddressPrefix": "54.94.109.128/27",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sc_aws_2_303",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sc_aws_2 303",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 303,
                            "protocol": "*",
                            "sourceAddressPrefix": "54.94.109.160/28",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office1_304",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office1 304",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 304,
                            "protocol": "*",
                            "sourceAddressPrefix": "59.154.111.154/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_bang_office1_305",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_bang_office1 305",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 305,
                            "protocol": "*",
                            "sourceAddressPrefix": "61.246.216.100/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_1_306",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_1 306",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 306,
                            "protocol": "*",
                            "sourceAddressPrefix": "63.140.32.0/19",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office1_307",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office1 307",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 307,
                            "protocol": "*",
                            "sourceAddressPrefix": "64.132.56.34/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_2_308",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_2 308",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 308,
                            "protocol": "*",
                            "sourceAddressPrefix": "66.117.16.0/20",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_3_309",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_3 309",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 309,
                            "protocol": "*",
                            "sourceAddressPrefix": "66.235.128.0/19",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office1_310",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office1 310",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 310,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.7/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office2_311",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office2 311",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 311,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.15/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office3_312",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office3 312",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 312,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.24/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office6_313",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office6 313",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 313,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.104/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office4_314",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office4 314",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 314,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.204/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office3_315",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office3 315",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 315,
                            "protocol": "*",
                            "sourceAddressPrefix": "85.115.58.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office4_316",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office4 316",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 316,
                            "protocol": "*",
                            "sourceAddressPrefix": "85.115.58.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office2_317",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office2 317",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 317,
                            "protocol": "*",
                            "sourceAddressPrefix": "116.50.58.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office3_318",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office3 318",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 318,
                            "protocol": "*",
                            "sourceAddressPrefix": "116.50.58.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_beij_office2_319",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_beij_office2 319",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 319,
                            "protocol": "*",
                            "sourceAddressPrefix": "116.51.24.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office1_320",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office1 320",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 320,
                            "protocol": "*",
                            "sourceAddressPrefix": "119.225.143.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office1_321",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office1 321",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 321,
                            "protocol": "*",
                            "sourceAddressPrefix": "121.242.198.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office2_322",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office2 322",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 322,
                            "protocol": "*",
                            "sourceAddressPrefix": "121.242.198.6/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office2_323",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office2 323",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 323,
                            "protocol": "*",
                            "sourceAddressPrefix": "121.242.198.26/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office_sec132_1_324",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office_sec132_1 324",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 324,
                            "protocol": "*",
                            "sourceAddressPrefix": "103.43.112.97/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office_sec132_2_325",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office_sec132_2 325",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 325,
                            "protocol": "*",
                            "sourceAddressPrefix": "103.43.112.98/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_bangalore_office_newnat_326",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_bangalore_office_newnat 326",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 326,
                            "protocol": "*",
                            "sourceAddressPrefix": "103.43.114.129/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_paris_office1_327",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_paris_office1 327",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 327,
                            "protocol": "*",
                            "sourceAddressPrefix": "149.7.98.227/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_tc_office1_328",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_tc_office1 328",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 328,
                            "protocol": "*",
                            "sourceAddressPrefix": "174.46.147.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_4_329",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_4 329",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 329,
                            "protocol": "*",
                            "sourceAddressPrefix": "185.34.188.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_bas_office1_330",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_bas_office1 330",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 330,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.117.11/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_east_coast_office_1_331",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_east_coast_office_1 331",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 331,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.118.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_east_coast_office_2_332",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_east_coast_office_2 332",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 332,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.118.6/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_east_cost_office_2_333",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_east_cost_office_2 333",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 333,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.118.254/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_dub_s7_334",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_dub_s7 334",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 334,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.1.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office1_335",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office1 335",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 335,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.3.7/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office2_336",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office2 336",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 336,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.3.136/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_nj2_337",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_nj2 337",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 337,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.4.0/25",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_newt_office1_338",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_newt_office1 338",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 338,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.4.10/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ott_office1_339",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ott_office1 339",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 339,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.5.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ott_office2_340",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ott_office2 340",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 340,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.5.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_waltham_office_341",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_waltham_office 341",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 341,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.6.5/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ut1_office_342",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ut1_office 342",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 342,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.9.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office1_343",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office1 343",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 343,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.200/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office3_344",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office3 344",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 344,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.201/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office3_345",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office3 345",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 345,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.202/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office4_346",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office4 346",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 346,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.203/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office5_347",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office5 347",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 347,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.204/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office6_348",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office6 348",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 348,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.205/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office7_349",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office7 349",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 349,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.206/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office8_350",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office8 350",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 350,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.207/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office9_351",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office9 351",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 351,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.208/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office10_352",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office10 352",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 352,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.209/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office11_353",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office11 353",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 353,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.210/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office2_354",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office2 354",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 354,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.11.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_dal_office1_355",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_dal_office1 355",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 355,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.16.0/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office4_356",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office4 356",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 356,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.19.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sea_office1_357",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sea_office1 357",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 357,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.22.5/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sea_office2_358",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sea_office2 358",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 358,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.22.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_5_359",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_5 359",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 359,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.243.224.0/19",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_dub_office1_360",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_dub_office1 360",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 360,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.104.215.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office1_361",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office1 361",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 361,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.105.139.131/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office2_362",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office2 362",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 362,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.105.139.132/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_buc_office1_363",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_buc_office1 363",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 363,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.105.140.131/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_tyo_office1_364",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_tyo_office1 364",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 364,
                            "protocol": "*",
                            "sourceAddressPrefix": "202.32.93.230/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_tyo_office2_365",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_tyo_office2 365",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 365,
                            "protocol": "*",
                            "sourceAddressPrefix": "202.32.93.231/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_beij_office1_366",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_beij_office1 366",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 366,
                            "protocol": "*",
                            "sourceAddressPrefix": "203.86.63.130/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sv.da2-1_367",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sv.da2-1 367",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 367,
                            "protocol": "*",
                            "sourceAddressPrefix": "205.216.15.64/27",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_londc_s7_368",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_londc_s7 368",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 368,
                            "protocol": "*",
                            "sourceAddressPrefix": "205.217.7.128/25",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sv.da2-2_369",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sv.da2-2 369",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 369,
                            "protocol": "*",
                            "sourceAddressPrefix": "205.219.231.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sing_s7_370",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sing_s7 370",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 370,
                            "protocol": "*",
                            "sourceAddressPrefix": "206.99.155.128/25",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_il_office1_371",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_il_office1 371",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 371,
                            "protocol": "*",
                            "sourceAddressPrefix": "207.232.19.162/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_6_372",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_6 372",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 372,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.67.40.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_7_373",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_7 373",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 373,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.77.136.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office2_374",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office2 374",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 374,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.87.234.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office3_375",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office3 375",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 375,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.87.234.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_8_376",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_8 376",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 376,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.91.168.0/21",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_9_377",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_9 377",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 377,
                            "protocol": "*",
                            "sourceAddressPrefix": "216.104.214.0/23",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_10_378",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_10 378",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 378,
                            "protocol": "*",
                            "sourceAddressPrefix": "216.104.216.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office5_379",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office5 379",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 379,
                            "protocol": "*",
                            "sourceAddressPrefix": "216.104.220.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_rp_office1_380",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_rp_office1 380",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 380,
                            "protocol": "*",
                            "sourceAddressPrefix": "217.33.142.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office-NEREQ-3594_381",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office-NEREQ-3594 381",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 381,
                            "protocol": "*",
                            "sourceAddressPrefix": "59.100.121.82/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_mai1_corp_382",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_mai1_corp 382",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 382,
                            "protocol": "*",
                            "sourceAddressPrefix": "77.67.50.96/28",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_mai1_techops_383",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_mai1_techops 383",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 383,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.124.0/24",
                            "sourcePortRange": "*"
                        }
                    }
                ]
            },
            "type": "Microsoft.Network/networkSecurityGroups"
        },
        {
            "apiVersion": "[variables('apiVersionStorage')]",
            "copy": {
                "count": "[variables('agentproxyStorageAccountsCount')]",
                "name": "loop"
            },
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('storageAccountPrefixes')[mod(add(copyIndex(),variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(copyIndex(),variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName'))]",
            "properties": {
                "accountType": "[variables('vmSizesMap')[variables('agentproxyVMSize')].storageAccountType]"
            },
            "type": "Microsoft.Storage/storageAccounts"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('agentproxyIPAddressName')]",
            "properties": {
                "dnsSettings": {
                    "domainNameLabel": "[variables('agentproxyEndpointDNSNamePrefix')]"
                },
                "publicIPAllocationMethod": "Dynamic"
            },
            "type": "Microsoft.Network/publicIPAddresses"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('agentproxyIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('agentproxyLbName')]",
            "properties": {
                "backendAddressPools": [
                    {
                        "name": "[variables('agentproxyLbBackendPoolName')]"
                    }
                ],
                "frontendIPConfigurations": [
                    {
                        "name": "[variables('agentproxyLbIPConfigName')]",
                        "properties": {
                            "publicIPAddress": {
                                "id": "[resourceId('Microsoft.Network/publicIPAddresses',variables('agentproxyIPAddressName'))]"
                            }
                        }
                    }
                ],
                "inboundNatRules": [],
                "loadBalancingRules": [
                    {
                        "name": "LBRule80",
                        "properties": {
                            "backendAddressPool": {
                                "id": "[concat(variables('agentproxyLbID'), '/backendAddressPools/', variables('agentproxyLbBackendPoolName'))]"
                            },
                            "backendPort": 80,
                            "enableFloatingIP": false,
                            "frontendIPConfiguration": {
                                "id": "[variables('agentproxyLbIPConfigID')]"
                            },
                            "frontendPort": 80,
                            "idleTimeoutInMinutes": 5,
                            "loadDistribution": "Default",
                            "probe": {
                                "id": "[concat(variables('agentproxyLbID'),'/probes/tcp80Probe')]"
                            },
                            "protocol": "tcp"
                        }
                    },
                    {
                        "name": "LBRule443",
                        "properties": {
                            "backendAddressPool": {
                                "id": "[concat(variables('agentproxyLbID'), '/backendAddressPools/', variables('agentproxyLbBackendPoolName'))]"
                            },
                            "backendPort": 443,
                            "enableFloatingIP": false,
                            "frontendIPConfiguration": {
                                "id": "[variables('agentproxyLbIPConfigID')]"
                            },
                            "frontendPort": 443,
                            "idleTimeoutInMinutes": 5,
                            "loadDistribution": "Default",
                            "probe": {
                                "id": "[concat(variables('agentproxyLbID'),'/probes/tcp443Probe')]"
                            },
                            "protocol": "tcp"
                        }
                    }
                ],
                "probes": [
                    {
                        "name": "tcp80Probe",
                        "properties": {
                            "intervalInSeconds": "5",
                            "numberOfProbes": "2",
                            "port": 80,
                            "protocol": "tcp"
                        }
                    },
                    {
                        "name": "tcp443Probe",
                        "properties": {
                            "intervalInSeconds": "5",
                            "numberOfProbes": "2",
                            "port": 443,
                            "protocol": "tcp"
                        }
                    }
                ]
            },
            "type": "Microsoft.Network/loadBalancers"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[variables('vnetID')]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName'))]",
                "[concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName'))]",
                "[concat('Microsoft.Network/loadBalancers/', variables('agentproxyLbName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('agentproxyVMNamePrefix'), '-vmss')]",
            "properties": {
                "upgradePolicy": {
                    "mode": "Manual"
                },
                "virtualMachineProfile": {
                    "networkProfile": {
                        "networkInterfaceConfigurations": [
                            {
                                "name": "nic",
                                "properties": {
                                    "ipConfigurations": [
                                        {
                                            "name": "nicipconfig",
                                            "properties": {
                                                "loadBalancerBackendAddressPools": [
                                                    {
                                                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('agentproxyLbName'), '/backendAddressPools/',variables('agentproxyLbBackendPoolName'))]"
                                                    }
                                                ],
                                                "subnet": {
                                                    "id": "[variables('agentproxyVnetSubnetID')]"
                                                }
                                            }
                                        }
                                    ],
                                    "primary": "true"
                                }
                            }
                        ]
                    },
                    "osProfile": {
                        "adminUsername": "[variables('adminUsername')]",
                        "computerNamePrefix": "[variables('agentproxyVMNamePrefix')]",
                        "customData": "[base64(concat('{\"networkd\":{},\"systemd\":{\"units\":[{\"dropins\":[{\"name\":\"11-docker-namespaces.conf\",\"contents\":\"[Service]\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo touch /etc/subuid /etc/subgid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subuid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subgid\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; /usr/bin/systemctl set-environment DOCKER_OPTS=--userns-remap=default\\\"\\u000A\"}],\"enable\":true,\"name\":\"docker.service\"},{\"enable\":true,\"name\":\"ethos-files.service\",\"contents\":\"[Unit]\\u000ADescription=Ethos Setup: Custom Files\\u000AAfter=network-online.target\\u000A[Service]\\u000AType=oneshot\\u000ARemainAfterExit=yes\\u000AExecStartPre=/bin/mkdir -p /var/lib/dcos\\u000AExecStartPre=/usr/bin/bash -c \\\"/bin/echo MESOS_ATTRIBUTES=ethos_role:proxy\\u005c;zone:',resourceGroup().location,' \\u003e /var/lib/dcos/mesos-slave-common\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo setenforce 1 \\u0026\\u0026 sudo cp --remove-destination $(readlink -f /etc/selinux/config) /etc/selinux/config \\u0026\\u0026 sudo sed -i.bak \\\"s/SELINUX=permissive/SELINUX=enforcing/g\\\" /etc/selinux/config\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; if [[ $(mount | grep xen) ]]; then sudo umount /proc/xen; fi\\\"\\u000AExecStart=/bin/bash -c \\\"exit 0\\\"\\u000A[Install]\\u000AWantedBy=multi-user.target\\u000A\"},{\"dropins\":[{\"name\":\"08-dcos-adminrouter-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/adminrouter.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000A\"}],\"name\":\"dcos-adminrouter.service\"},{\"dropins\":[{\"name\":\"08-dcos-oauth-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/proxy.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000AEnvironment=OAUTH_ISSUER_URL=https://ethos-platform.auth0.com/\\u000A\"},{\"name\":\"09-dcos-oauth-ldap.conf\",\"contents\":\"[Service]\\u000AEnvironment=OAUTH_ALLOW_LOCAL_USERS=false\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER=\\\"\\\"\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER_HASH=\\\"\\\"\\u000AEnvironment=OAUTH_ALLOW_LDAP_USERS=false\\u000AEnvironment=OAUTH_LDAP_WHITELIST_ONLY=false\\u000A\"},{\"name\":\"11-dcos-oauth-ethos-binary.conf\",\"contents\":\"[Service]\\u000AExecStart=\\u000AExecStart=/opt/ethos/bin/dcos-oauth serve --addr=127.0.0.1:8101 --zk-addr=127.0.0.1:2181 --secret-key-path=/var/lib/dcos/dcos-oauth/auth-token-secret --segment-key=51ybGTeFEFU1xo6u10XMDrr6kATFyRyh\\u000A\"}],\"name\":\"dcos-oauth.service\"}]},\"storage\":{\"files\":[{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/sssd/sssd.conf\",\"contents\":{\"source\":\"data:,%5Bsssd%5D%0Aconfig_file_version%20%3D%202%0Aservices%20%3D%20nss%2C%20pam%2C%20ssh%0Adomains%20%3D%20LDAP%0A%5Bdomain%2FLDAP%5D%0Aldap_id_use_start_tls%20%3D%20true%0Aldap_schema%20%3D%20rfc2307bis%0Aldap_search_base%20%3D%20o%3Dadbe%0Aid_provider%20%3D%20ldap%0Aauth_provider%20%3D%20ldap%0Achpass_provider%20%3D%20ldap%0Aldap_uri%20%3D%20ldap%3A%2F%2Fldap.loc.adobe.net%3A389%0Acache_credentials%20%3D%20true%0Aldap_tls_cacert%20%3D%20%2Fetc%2Fssl%2Fcerts%2Fca-certificates.crt%0Aldap_tls_reqcert%20%3D%20demand%0Aldap_group_member%20%3D%20uniqueMember%0Aldap_user_ssh_public_key%20%3D%20sshPublicKey%0Aaccess_provider%20%3D%20simple%0Asimple_allow_groups%20%3D%20CST%2CCPT%2CNetServ_NetOps%2CSST%0A%5Bnss%5D%0Adefault_shell%20%3D%20%2Fbin%2Fbash%0Afilter_users%20%3D%20core%2Croot%0A\",\"verification\":{}},\"mode\":384},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/coreos/update.conf\",\"contents\":{\"source\":\"data:,REBOOT_STRATEGY%3Doff%0AGROUP%3Dstable%0ASERVER%3Dhttps%3A%2F%2Fpublic.update.core-os.net%2Fv1%2Fupdate%2F%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/repository-url\",\"contents\":{\"source\":\"data:,https%3A%2F%2Fdcosio.azureedge.net%2Fdcos%2Fstable\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/bootstrap-id\",\"contents\":{\"source\":\"data:,BOOTSTRAP_ID%3D5df43052907c021eeb5de145419a3da1898c58a5\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/cluster-packages.json\",\"contents\":{\"source\":\"data:,%5B%22dcos-config--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%2C%22dcos-metadata--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/rexray/config.yml\",\"contents\":{\"source\":\"data:,rexray%3A%0A%20%20loglevel%3A%20info%0A%20%20modules%3A%0A%20%20%20%20default-admin%3A%0A%20%20%20%20%20%20host%3A%20tcp%3A%2F%2F127.0.0.1%3A61003%0A%20%20%20%20default-docker%3A%0A%20%20%20%20%20%20disabled%3A%20true%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/mesos-master-provider\",\"contents\":{\"source\":\"data:,MESOS_CLUSTER%3D',resourceGroup().name,'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/adminrouter.env\",\"contents\":{\"source\":\"data:,ADMINROUTER_ACTIVATE_AUTH_MODULE%3D',variables('oauthEnabled'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor\",\"contents\":{\"source\":\"data:,EXHIBITOR_BACKEND%3DAZURE%0AAZURE_CONTAINER%3Ddcos-exhibitor%0AAZURE_PREFIX%3D',variables('masterPublicIPAddressName'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/ui-config.json\",\"contents\":{\"source\":\"data:,%7B%22uiConfiguration%22%3A%20%7B%22plugins%22%3A%20%7B%22banner%22%3A%20%7B%22enabled%22%3A%20false%2C%22backgroundColor%22%3A%20%22%231E232F%22%2C%22foregroundColor%22%3A%20%22%23FFFFFF%22%2C%22headerTitle%22%3A%20null%2C%22headerContent%22%3A%20null%2C%22footerContent%22%3A%20null%2C%22imagePath%22%3A%20null%2C%22dismissible%22%3A%20null%7D%2C%22branding%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22external-links%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22authentication%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22oauth%22%3A%20%7B%22enabled%22%3A%20',variables('oauthEnabled'),'%2C%22authHost%22%3A%20%22https://ethos-platform.auth0.com%22%7D%2C%22tracking%22%3A%20%7B%22enabled%22%3A%20false%7D%7D%7D%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/pkginfo.json\",\"contents\":{\"source\":\"data:,%7B%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure_slave\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/auth.env\",\"contents\":{\"source\":\"data:,SEED%3Da849kd2nb3laqp485nnf75jk1oou%0AROLE%3Dslave%0ASERVICES%3D%22mesos-agent,metronome,marathon,ethos-services,chronos,etcd,booster,spark,hdfs,kafka%22%0A\",\"verification\":{}},\"mode\":256},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/ldap.toml\",\"contents\":{\"source\":\"data:,%5Bserver%5D%0Ahost%20%3D%20%22ldap.loc.adobe.net%22%0Aport%20%3D%20636%0Ause_ssl%20%3D%20true%0Assl_skip_verify%20%3D%20false%0Abind_dn%20%3D%20%22cn%3D%25s%2Cou%3DUsers%2Co%3Dadbe%22%0Asearch_filter%20%3D%20%22(cn%3D%25s)%22%0Asearch_base_dns%20%3D%20%5B%22ou%3DUsers%2Co%3Dadbe%22%5D%0Adefault_role%20%3D%20%22%22%0A%5Bserver.attributes%5D%0Aname%20%3D%20%22givenName%22%0Asurname%20%3D%20%22sn%22%0Ausername%20%3D%20%22cn%22%0Amember_of%20%3D%20%22memberOf%22%0Aemail%20%3D%20%20%22mail%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DCST%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DHA_team%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/master_list\",\"contents\":{\"source\":\"data:,%5B%22',reference(variables('masterVMNic')[0]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[1]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[2]).ipConfigurations[0].properties.privateIPAddress,'%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor.properties\",\"contents\":{\"source\":\"data:,com.netflix.exhibitor.azure.account-name%3D',variables('masterStorageAccountExhibitorName'),'%0Acom.netflix.exhibitor.azure.account-key%3D',listKeys(resourceId('Microsoft.Storage/storageAccounts',variables('masterStorageAccountExhibitorName')),'2015-06-15').key1,'\",\"verification\":{}},\"mode\":420}]},\"ignition\":{\"version\":\"2.0.0\",\"config\":{\"append\":[{\"source\":\"https://git.corp.adobe.com/raw/animjain/dcos-infrastructure-aetherchanges-egressrules/master/bootstrap/ignition-remote.json?token=AAA--fwrQ2omtmLAsRNHBRgB9ntf69Uoks5Yvo3FwA%3D%3D\",\"verification\":{}}]}}}'))]",
                        "linuxConfiguration": {
                            "disablePasswordAuthentication": "true",
                            "ssh": {
                                "publicKeys": [
                                    {
                                        "keyData": "[parameters('sshRSAPublicKey')]",
                                        "path": "[variables('sshKeyPath')]"
                                    }
                                ]
                            }
                        }
                    },
                    "storageProfile": {
                        "imageReference": {
                            "offer": "[variables('osImageOffer')]",
                            "publisher": "[variables('osImagePublisher')]",
                            "sku": "[variables('osImageSKU')]",
                            "version": "[variables('osImageVersion')]"
                        },
                        "osDisk": {
                            "caching": "ReadOnly",
                            "createOption": "FromImage",
                            "name": "vmssosdisk",
                            "vhdContainers": [
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(0,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(0,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(1,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(1,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(2,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(2,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(3,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(3,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]",
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('storageAccountPrefixes')[mod(add(4,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('storageAccountPrefixes')[div(add(4,variables('agentproxyStorageAccountOffset')),variables('storageAccountPrefixesCount'))],variables('agentproxyAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'osdisk')]"
                            ]
                        }
                    }
                }
            },
            "sku": {
                "capacity": "[variables('agentproxyCount')]",
                "name": "[variables('agentproxyVMSize')]",
                "tier": "Standard"
            },
            "tags": {
                "creationSource": "[concat('acsengine-', variables('agentproxyVMNamePrefix'), '-vmss')]"
            },
            "type": "Microsoft.Compute/virtualMachineScaleSets"
        },
        {
            "apiVersion": "[variables('apiVersionStorage')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('masterStorageAccountName')]",
            "properties": {
                "accountType": "[variables('vmSizesMap')[variables('masterVMSize')].storageAccountType]"
            },
            "type": "Microsoft.Storage/storageAccounts"
        },
        {
            "apiVersion": "[variables('apiVersionStorage')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('masterStorageAccountExhibitorName')]",
            "properties": {
                "accountType": "Standard_LRS"
            },
            "type": "Microsoft.Storage/storageAccounts"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[concat('Microsoft.Network/networkSecurityGroups/', variables('agentworkerNSGName'))]",
                "[concat('Microsoft.Network/networkSecurityGroups/', variables('agentworkeraetherNSGName'))]",
                "[concat('Microsoft.Network/networkSecurityGroups/', variables('agentcontrolNSGName'))]",
                "[concat('Microsoft.Network/networkSecurityGroups/', variables('agentproxyNSGName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('virtualNetworkName')]",
            "properties": {
                "addressSpace": {
                    "addressPrefixes": [
                        "[variables('masterSubnet')]",
                        "[variables('agentworkerSubnet')]",
                        "[variables('agentworkeraetherSubnet')]",
                        "[variables('agentcontrolSubnet')]",
                        "[variables('agentproxySubnet')]"
                    ]
                },
                "subnets": [
                    {
                        "name": "[variables('masterSubnetName')]",
                        "properties": {
                            "addressPrefix": "[variables('masterSubnet')]"
                        }
                    },
                    {
                        "name": "[variables('agentworkerSubnetName')]",
                        "properties": {
                            "addressPrefix": "[variables('agentworkerSubnet')]",
                            "networkSecurityGroup": {
                                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('agentworkerNSGName'))]"
                            }
                        }
                    },
                    {
                        "name": "[variables('agentworkeraetherSubnetName')]",
                        "properties": {
                            "addressPrefix": "[variables('agentworkeraetherSubnet')]",
                            "networkSecurityGroup": {
                                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('agentworkeraetherNSGName'))]"
                            }
                        }
                    },
                    {
                        "name": "[variables('agentcontrolSubnetName')]",
                        "properties": {
                            "addressPrefix": "[variables('agentcontrolSubnet')]",
                            "networkSecurityGroup": {
                                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('agentcontrolNSGName'))]"
                            }
                        }
                    },
                    {
                        "name": "[variables('agentproxySubnetName')]",
                        "properties": {
                            "addressPrefix": "[variables('agentproxySubnet')]",
                            "networkSecurityGroup": {
                                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('agentproxyNSGName'))]"
                            }
                        }
                    }
                ]
            },
            "type": "Microsoft.Network/virtualNetworks"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('masterAvailabilitySet')]",
            "properties": {},
            "type": "Microsoft.Compute/availabilitySets"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('masterPublicIPAddressName')]",
            "properties": {
                "dnsSettings": {
                    "domainNameLabel": "[variables('masterEndpointDNSNamePrefix')]"
                },
                "publicIPAllocationMethod": "Dynamic"
            },
            "type": "Microsoft.Network/publicIPAddresses"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "dependsOn": [
                "[concat('Microsoft.Network/publicIPAddresses/', variables('masterPublicIPAddressName'))]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[variables('masterLbName')]",
            "properties": {
                "backendAddressPools": [
                    {
                        "name": "[variables('masterLbBackendPoolName')]"
                    }
                ],
                "frontendIPConfigurations": [
                    {
                        "name": "[variables('masterLbIPConfigName')]",
                        "properties": {
                            "publicIPAddress": {
                                "id": "[resourceId('Microsoft.Network/publicIPAddresses',variables('masterPublicIPAddressName'))]"
                            }
                        }
                    }
                ],
                "loadBalancingRules": [
                    {
                        "name": "LBMasterRule80",
                        "properties": {
                            "backendAddressPool": {
                                "id": "[concat(variables('masterLbID'), '/backendAddressPools/', variables('masterLbBackendPoolName'))]"
                            },
                            "backendPort": 80,
                            "enableFloatingIP": false,
                            "frontendIPConfiguration": {
                                "id": "[variables('masterLbIPConfigID')]"
                            },
                            "frontendPort": 80,
                            "idleTimeoutInMinutes": 5,
                            "loadDistribution": "Default",
                            "probe": {
                                "id": "[concat(variables('masterLbID'),'/probes/tcp80ProbeMaster')]"
                            },
                            "protocol": "tcp"
                        }
                    }
                ],
                "probes": [
                    {
                        "name": "tcp80ProbeMaster",
                        "properties": {
                            "intervalInSeconds": "5",
                            "numberOfProbes": "2",
                            "port": 80,
                            "protocol": "tcp"
                        }
                    }
                ]
            },
            "type": "Microsoft.Network/loadBalancers"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "copy": {
                "count": "[variables('masterCount')]",
                "name": "masterLbLoopNode"
            },
            "dependsOn": [
                "[variables('masterLbID')]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('masterLbName'), '/', 'SSH-', variables('masterVMNamePrefix'), copyIndex())]",
            "properties": {
                "backendPort": 22,
                "enableFloatingIP": false,
                "frontendIPConfiguration": {
                    "id": "[variables('masterLbIPConfigID')]"
                },
                "frontendPort": "[copyIndex(2200)]",
                "protocol": "tcp"
            },
            "type": "Microsoft.Network/loadBalancers/inboundNatRules"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "location": "[resourceGroup().location]",
            "name": "[variables('masterNSGName')]",
            "properties": {
                "securityRules": [
                    {
                        "name": "adobe_netblock_aws_sin3_1_300",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock aws_sin3_1 300",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 300,
                            "protocol": "*",
                            "sourceAddressPrefix": "46.137.252.0/28",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_aws_sin3_2_301",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock aws_sin3_2 301",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 301,
                            "protocol": "*",
                            "sourceAddressPrefix": "46.137.252.16/30",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sc_aws_1_302",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sc_aws_1 302",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 302,
                            "protocol": "*",
                            "sourceAddressPrefix": "54.94.109.128/27",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sc_aws_2_303",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sc_aws_2 303",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 303,
                            "protocol": "*",
                            "sourceAddressPrefix": "54.94.109.160/28",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office1_304",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office1 304",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 304,
                            "protocol": "*",
                            "sourceAddressPrefix": "59.154.111.154/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_bang_office1_305",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_bang_office1 305",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 305,
                            "protocol": "*",
                            "sourceAddressPrefix": "61.246.216.100/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_1_306",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_1 306",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 306,
                            "protocol": "*",
                            "sourceAddressPrefix": "63.140.32.0/19",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office1_307",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office1 307",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 307,
                            "protocol": "*",
                            "sourceAddressPrefix": "64.132.56.34/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_2_308",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_2 308",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 308,
                            "protocol": "*",
                            "sourceAddressPrefix": "66.117.16.0/20",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_3_309",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_3 309",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 309,
                            "protocol": "*",
                            "sourceAddressPrefix": "66.235.128.0/19",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office1_310",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office1 310",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 310,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.7/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office2_311",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office2 311",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 311,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.15/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office3_312",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office3 312",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 312,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.24/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office6_313",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office6 313",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 313,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.104/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office4_314",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office4 314",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 314,
                            "protocol": "*",
                            "sourceAddressPrefix": "76.74.170.204/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office3_315",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office3 315",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 315,
                            "protocol": "*",
                            "sourceAddressPrefix": "85.115.58.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office4_316",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office4 316",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 316,
                            "protocol": "*",
                            "sourceAddressPrefix": "85.115.58.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office2_317",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office2 317",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 317,
                            "protocol": "*",
                            "sourceAddressPrefix": "116.50.58.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office3_318",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office3 318",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 318,
                            "protocol": "*",
                            "sourceAddressPrefix": "116.50.58.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_beij_office2_319",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_beij_office2 319",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 319,
                            "protocol": "*",
                            "sourceAddressPrefix": "116.51.24.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office1_320",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office1 320",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 320,
                            "protocol": "*",
                            "sourceAddressPrefix": "119.225.143.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office1_321",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office1 321",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 321,
                            "protocol": "*",
                            "sourceAddressPrefix": "121.242.198.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office2_322",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office2 322",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 322,
                            "protocol": "*",
                            "sourceAddressPrefix": "121.242.198.6/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office2_323",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office2 323",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 323,
                            "protocol": "*",
                            "sourceAddressPrefix": "121.242.198.26/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office_sec132_1_324",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office_sec132_1 324",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 324,
                            "protocol": "*",
                            "sourceAddressPrefix": "103.43.112.97/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_noida_office_sec132_2_325",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_noida_office_sec132_2 325",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 325,
                            "protocol": "*",
                            "sourceAddressPrefix": "103.43.112.98/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_bangalore_office_newnat_326",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_bangalore_office_newnat 326",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 326,
                            "protocol": "*",
                            "sourceAddressPrefix": "103.43.114.129/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_paris_office1_327",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_paris_office1 327",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 327,
                            "protocol": "*",
                            "sourceAddressPrefix": "149.7.98.227/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_tc_office1_328",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_tc_office1 328",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 328,
                            "protocol": "*",
                            "sourceAddressPrefix": "174.46.147.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_4_329",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_4 329",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 329,
                            "protocol": "*",
                            "sourceAddressPrefix": "185.34.188.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_bas_office1_330",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_bas_office1 330",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 330,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.117.11/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_east_coast_office_1_331",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_east_coast_office_1 331",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 331,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.118.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_east_coast_office_2_332",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_east_coast_office_2 332",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 332,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.118.6/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_east_cost_office_2_333",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_east_cost_office_2 333",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 333,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.118.254/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_dub_s7_334",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_dub_s7 334",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 334,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.1.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office1_335",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office1 335",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 335,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.3.7/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office2_336",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office2 336",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 336,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.3.136/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_nj2_337",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_nj2 337",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 337,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.4.0/25",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_newt_office1_338",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_newt_office1 338",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 338,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.4.10/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ott_office1_339",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ott_office1 339",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 339,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.5.2/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ott_office2_340",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ott_office2 340",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 340,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.5.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_waltham_office_341",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_waltham_office 341",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 341,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.6.5/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ut1_office_342",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ut1_office 342",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 342,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.9.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office1_343",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office1 343",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 343,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.200/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office3_344",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office3 344",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 344,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.201/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office3_345",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office3 345",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 345,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.202/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office4_346",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office4 346",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 346,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.203/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office5_347",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office5 347",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 347,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.204/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office6_348",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office6 348",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 348,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.205/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office7_349",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office7 349",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 349,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.206/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office8_350",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office8 350",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 350,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.207/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office9_351",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office9 351",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 351,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.208/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office10_352",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office10 352",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 352,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.209/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office11_353",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office11 353",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 353,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.10.210/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office2_354",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office2 354",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 354,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.11.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_dal_office1_355",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_dal_office1 355",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 355,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.16.0/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sj_office4_356",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sj_office4 356",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 356,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.19.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sea_office1_357",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sea_office1 357",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 357,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.22.5/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sea_office2_358",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sea_office2 358",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 358,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.150.22.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_5_359",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_5 359",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 359,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.243.224.0/19",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_dub_office1_360",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_dub_office1 360",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 360,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.104.215.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office1_361",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office1 361",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 361,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.105.139.131/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ham_office2_362",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ham_office2 362",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 362,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.105.139.132/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_buc_office1_363",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_buc_office1 363",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 363,
                            "protocol": "*",
                            "sourceAddressPrefix": "193.105.140.131/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_tyo_office1_364",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_tyo_office1 364",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 364,
                            "protocol": "*",
                            "sourceAddressPrefix": "202.32.93.230/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_tyo_office2_365",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_tyo_office2 365",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 365,
                            "protocol": "*",
                            "sourceAddressPrefix": "202.32.93.231/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_beij_office1_366",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_beij_office1 366",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 366,
                            "protocol": "*",
                            "sourceAddressPrefix": "203.86.63.130/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sv.da2-1_367",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sv.da2-1 367",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 367,
                            "protocol": "*",
                            "sourceAddressPrefix": "205.216.15.64/27",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_londc_s7_368",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_londc_s7 368",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 368,
                            "protocol": "*",
                            "sourceAddressPrefix": "205.217.7.128/25",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_sv.da2-2_369",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock sv.da2-2 369",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 369,
                            "protocol": "*",
                            "sourceAddressPrefix": "205.219.231.0/24",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_sing_s7_370",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_sing_s7 370",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 370,
                            "protocol": "*",
                            "sourceAddressPrefix": "206.99.155.128/25",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_il_office1_371",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_il_office1 371",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 371,
                            "protocol": "*",
                            "sourceAddressPrefix": "207.232.19.162/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_6_372",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_6 372",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 372,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.67.40.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_7_373",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_7 373",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 373,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.77.136.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office2_374",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office2 374",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 374,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.87.234.150/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_ny_office3_375",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_ny_office3 375",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 375,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.87.234.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_8_376",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_8 376",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 376,
                            "protocol": "*",
                            "sourceAddressPrefix": "208.91.168.0/21",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_9_377",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_9 377",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 377,
                            "protocol": "*",
                            "sourceAddressPrefix": "216.104.214.0/23",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_techops_10_378",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_techops_10 378",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 378,
                            "protocol": "*",
                            "sourceAddressPrefix": "216.104.216.0/22",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_la_office5_379",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_la_office5 379",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 379,
                            "protocol": "*",
                            "sourceAddressPrefix": "216.104.220.4/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_rp_office1_380",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_rp_office1 380",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 380,
                            "protocol": "*",
                            "sourceAddressPrefix": "217.33.142.180/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_syd_office-NEREQ-3594_381",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_syd_office-NEREQ-3594 381",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 381,
                            "protocol": "*",
                            "sourceAddressPrefix": "59.100.121.82/32",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_mai1_corp_382",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_mai1_corp 382",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 382,
                            "protocol": "*",
                            "sourceAddressPrefix": "77.67.50.96/28",
                            "sourcePortRange": "*"
                        }
                    },
                    {
                        "name": "adobe_netblock_adbe_mai1_techops_383",
                        "properties": {
                            "access": "Allow",
                            "description": "Adobe Netblock adbe_mai1_techops 383",
                            "destinationAddressPrefix": "*",
                            "destinationPortRange": "*",
                            "direction": "Inbound",
                            "priority": 383,
                            "protocol": "*",
                            "sourceAddressPrefix": "192.147.124.0/24",
                            "sourcePortRange": "*"
                        }
                    }
                ],
                "subnets": [
                    {
                        "id": "[variables('masterVnetSubnetID')]"
                    }
                ]
            },
            "type": "Microsoft.Network/networkSecurityGroups"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "copy": {
                "count": "[variables('masterCount')]",
                "name": "nicLoopNode"
            },
            "dependsOn": [
                "[variables('masterNSGID')]",
                "[variables('vnetID')]",
                "[variables('masterLbID')]",
                "[concat(variables('masterLbID'),'/inboundNatRules/SSH-',variables('masterVMNamePrefix'),copyIndex())]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('masterVMNamePrefix'), 'nic-', copyIndex())]",
            "properties": {
                "ipConfigurations": [
                    {
                        "name": "ipConfigNode",
                        "properties": {
                            "loadBalancerBackendAddressPools": [
                                {
                                    "id": "[concat(variables('masterLbID'), '/backendAddressPools/', variables('masterLbBackendPoolName'))]"
                                }
                            ],
                            "loadBalancerInboundNatRules": [
                                {
                                    "id": "[concat(variables('masterLbID'),'/inboundNatRules/SSH-',variables('masterVMNamePrefix'),copyIndex())]"
                                }
                            ],
                            "privateIPAddress": "[concat(variables('masterFirstAddrPrefix'), copyIndex(int(variables('masterFirstAddrOctet4'))))]",
                            "privateIPAllocationMethod": "Static",
                            "subnet": {
                                "id": "[variables('masterVnetSubnetID')]"
                            }
                        }
                    }
                ],
                "networkSecurityGroup": {
                    "id": "[variables('masterNSGID')]"
                }
            },
            "type": "Microsoft.Network/networkInterfaces"
        },
        {
            "apiVersion": "[variables('apiVersionDefault')]",
            "copy": {
                "count": "[variables('masterCount')]",
                "name": "vmLoopNode"
            },
            "dependsOn": [
                "[concat('Microsoft.Network/networkInterfaces/', variables('masterVMNamePrefix'), 'nic-', copyIndex())]",
                "[concat('Microsoft.Compute/availabilitySets/',variables('masterAvailabilitySet'))]",
                "[variables('masterStorageAccountName')]",
                "[variables('masterStorageAccountExhibitorName')]"
            ],
            "location": "[resourceGroup().location]",
            "name": "[concat(variables('masterVMNamePrefix'), copyIndex())]",
            "properties": {
                "availabilitySet": {
                    "id": "[resourceId('Microsoft.Compute/availabilitySets',variables('masterAvailabilitySet'))]"
                },
                "hardwareProfile": {
                    "vmSize": "[variables('masterVMSize')]"
                },
                "networkProfile": {
                    "networkInterfaces": [
                        {
                            "id": "[resourceId('Microsoft.Network/networkInterfaces',concat(variables('masterVMNamePrefix'), 'nic-', copyIndex()))]"
                        }
                    ]
                },
                "osProfile": {
                    "adminUsername": "[variables('adminUsername')]",
                    "computername": "[concat(variables('masterVMNamePrefix'), copyIndex())]",
                    "customData": "[base64(concat('{\"networkd\":{},\"systemd\":{\"units\":[{\"dropins\":[{\"name\":\"11-docker-namespaces.conf\",\"contents\":\"[Service]\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo touch /etc/subuid /etc/subgid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subuid \\u0026\\u0026 sudo echo dockremap:100000:65536 \\u003e /etc/subgid\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; /usr/bin/systemctl set-environment DOCKER_OPTS=--userns-remap=default\\\"\\u000A\"}],\"enable\":true,\"name\":\"docker.service\"},{\"enable\":true,\"name\":\"ethos-files.service\",\"contents\":\"[Unit]\\u000ADescription=Ethos Setup: Custom Files\\u000AAfter=network-online.target\\u000A[Service]\\u000AType=oneshot\\u000ARemainAfterExit=yes\\u000AExecStartPre=/bin/mkdir -p /var/lib/dcos\\u000AExecStartPre=/usr/bin/bash -c \\\"/bin/echo MESOS_ATTRIBUTES=ethos_role:master\\u005c;zone:',resourceGroup().location,' \\u003e /var/lib/dcos/mesos-slave-common\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; sudo setenforce 1 \\u0026\\u0026 sudo cp --remove-destination $(readlink -f /etc/selinux/config) /etc/selinux/config \\u0026\\u0026 sudo sed -i.bak \\\"s/SELINUX=permissive/SELINUX=enforcing/g\\\" /etc/selinux/config\\\"\\u000AExecStartPre=/bin/bash -c \\\"[[ \\\"false\\\" == \\\"false\\\" ]] \\u0026\\u0026 exit 0; if [[ $(mount | grep xen) ]]; then sudo umount /proc/xen; fi\\\"\\u000AExecStart=/bin/bash -c \\\"exit 0\\\"\\u000A[Install]\\u000AWantedBy=multi-user.target\\u000A\"},{\"dropins\":[{\"name\":\"08-dcos-adminrouter-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/adminrouter.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000A\"}],\"name\":\"dcos-adminrouter.service\"},{\"dropins\":[{\"name\":\"08-dcos-oauth-okta-authentication.conf\",\"contents\":\"[Service]\\u000AEnvironmentFile=\\u000AEnvironmentFile=/opt/mesosphere/environment\\u000AEnvironmentFile=/opt/mesosphere/etc/proxy.env\\u000AEnvironment=OAUTH_AUTH_REDIRECTOR=https://ethos-platform.auth0.com\\u000AEnvironment=OAUTH_CLIENT_ID=FQW1AlrhD2Y8cWtiSgKEwmHI5RTWzLR3\\u000AEnvironment=OAUTH_ISSUER_URL=https://ethos-platform.auth0.com/\\u000A\"},{\"name\":\"09-dcos-oauth-ldap.conf\",\"contents\":\"[Service]\\u000AEnvironment=OAUTH_ALLOW_LOCAL_USERS=false\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER=\\\"\\\"\\u000AEnvironment=OAUTH_DEFAULT_LOCAL_USER_HASH=\\\"\\\"\\u000AEnvironment=OAUTH_ALLOW_LDAP_USERS=false\\u000AEnvironment=OAUTH_LDAP_WHITELIST_ONLY=false\\u000A\"},{\"name\":\"11-dcos-oauth-ethos-binary.conf\",\"contents\":\"[Service]\\u000AExecStart=\\u000AExecStart=/opt/ethos/bin/dcos-oauth serve --addr=127.0.0.1:8101 --zk-addr=127.0.0.1:2181 --secret-key-path=/var/lib/dcos/dcos-oauth/auth-token-secret --segment-key=51ybGTeFEFU1xo6u10XMDrr6kATFyRyh\\u000A\"}],\"name\":\"dcos-oauth.service\"}]},\"storage\":{\"files\":[{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/sssd/sssd.conf\",\"contents\":{\"source\":\"data:,%5Bsssd%5D%0Aconfig_file_version%20%3D%202%0Aservices%20%3D%20nss%2C%20pam%2C%20ssh%0Adomains%20%3D%20LDAP%0A%5Bdomain%2FLDAP%5D%0Aldap_id_use_start_tls%20%3D%20true%0Aldap_schema%20%3D%20rfc2307bis%0Aldap_search_base%20%3D%20o%3Dadbe%0Aid_provider%20%3D%20ldap%0Aauth_provider%20%3D%20ldap%0Achpass_provider%20%3D%20ldap%0Aldap_uri%20%3D%20ldap%3A%2F%2Fldap.loc.adobe.net%3A389%0Acache_credentials%20%3D%20true%0Aldap_tls_cacert%20%3D%20%2Fetc%2Fssl%2Fcerts%2Fca-certificates.crt%0Aldap_tls_reqcert%20%3D%20demand%0Aldap_group_member%20%3D%20uniqueMember%0Aldap_user_ssh_public_key%20%3D%20sshPublicKey%0Aaccess_provider%20%3D%20simple%0Asimple_allow_groups%20%3D%20CST%2CCPT%2CNetServ_NetOps%2CSST%0A%5Bnss%5D%0Adefault_shell%20%3D%20%2Fbin%2Fbash%0Afilter_users%20%3D%20core%2Croot%0A\",\"verification\":{}},\"mode\":384},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/coreos/update.conf\",\"contents\":{\"source\":\"data:,REBOOT_STRATEGY%3Doff%0AGROUP%3Dstable%0ASERVER%3Dhttps%3A%2F%2Fpublic.update.core-os.net%2Fv1%2Fupdate%2F%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/repository-url\",\"contents\":{\"source\":\"data:,https%3A%2F%2Fdcosio.azureedge.net%2Fdcos%2Fstable\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/bootstrap-id\",\"contents\":{\"source\":\"data:,BOOTSTRAP_ID%3D5df43052907c021eeb5de145419a3da1898c58a5\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-flags/cluster-packages.json\",\"contents\":{\"source\":\"data:,%5B%22dcos-config--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%2C%22dcos-metadata--setup_b1cd359287504efb780257bd12cc3a63704e42d4%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/rexray/config.yml\",\"contents\":{\"source\":\"data:,rexray%3A%0A%20%20loglevel%3A%20info%0A%20%20modules%3A%0A%20%20%20%20default-admin%3A%0A%20%20%20%20%20%20host%3A%20tcp%3A%2F%2F127.0.0.1%3A61003%0A%20%20%20%20default-docker%3A%0A%20%20%20%20%20%20disabled%3A%20true%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/mesos-master-provider\",\"contents\":{\"source\":\"data:,MESOS_CLUSTER%3D',resourceGroup().name,'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/adminrouter.env\",\"contents\":{\"source\":\"data:,ADMINROUTER_ACTIVATE_AUTH_MODULE%3D',variables('oauthEnabled'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor\",\"contents\":{\"source\":\"data:,EXHIBITOR_BACKEND%3DAZURE%0AAZURE_CONTAINER%3Ddcos-exhibitor%0AAZURE_PREFIX%3D',variables('masterPublicIPAddressName'),'\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/ui-config.json\",\"contents\":{\"source\":\"data:,%7B%22uiConfiguration%22%3A%20%7B%22plugins%22%3A%20%7B%22banner%22%3A%20%7B%22enabled%22%3A%20false%2C%22backgroundColor%22%3A%20%22%231E232F%22%2C%22foregroundColor%22%3A%20%22%23FFFFFF%22%2C%22headerTitle%22%3A%20null%2C%22headerContent%22%3A%20null%2C%22footerContent%22%3A%20null%2C%22imagePath%22%3A%20null%2C%22dismissible%22%3A%20null%7D%2C%22branding%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22external-links%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22authentication%22%3A%20%7B%22enabled%22%3A%20false%7D%2C%22oauth%22%3A%20%7B%22enabled%22%3A%20',variables('oauthEnabled'),'%2C%22authHost%22%3A%20%22https://ethos-platform.auth0.com%22%7D%2C%22tracking%22%3A%20%7B%22enabled%22%3A%20false%7D%7D%7D%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/pkginfo.json\",\"contents\":{\"source\":\"data:,%7B%7D%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/master\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure_master\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/roles/azure\",\"contents\":{\"source\":\"data:,\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/auth.env\",\"contents\":{\"source\":\"data:,SEED%3Da849kd2nb3laqp485nnf75jk1oou%0AROLE%3Dmaster%0ASERVICES%3D%22mesos-agent,metronome,marathon,ethos-services,chronos,etcd,booster,spark,hdfs,kafka%22%0A\",\"verification\":{}},\"mode\":256},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/ethos/ldap.toml\",\"contents\":{\"source\":\"data:,%5Bserver%5D%0Ahost%20%3D%20%22ldap.loc.adobe.net%22%0Aport%20%3D%20636%0Ause_ssl%20%3D%20true%0Assl_skip_verify%20%3D%20false%0Abind_dn%20%3D%20%22cn%3D%25s%2Cou%3DUsers%2Co%3Dadbe%22%0Asearch_filter%20%3D%20%22(cn%3D%25s)%22%0Asearch_base_dns%20%3D%20%5B%22ou%3DUsers%2Co%3Dadbe%22%5D%0Adefault_role%20%3D%20%22%22%0A%5Bserver.attributes%5D%0Aname%20%3D%20%22givenName%22%0Asurname%20%3D%20%22sn%22%0Ausername%20%3D%20%22cn%22%0Amember_of%20%3D%20%22memberOf%22%0Aemail%20%3D%20%20%22mail%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DCST%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A%5B%5Bserver.group_mappings%5D%5D%0Agroup_dn%20%3D%20%22cn%3DHA_team%2Cou%3DGroups%2Co%3Dadbe%22%0Aorg_role%20%3D%20%22Admin%22%0A\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/master_list\",\"contents\":{\"source\":\"data:,%5B%22',reference(variables('masterVMNic')[0]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[1]).ipConfigurations[0].properties.privateIPAddress,'%22%2C%22',reference(variables('masterVMNic')[2]).ipConfigurations[0].properties.privateIPAddress,'%22%5D\",\"verification\":{}},\"mode\":420},{\"group\":{},\"user\":{},\"filesystem\":\"root\",\"path\":\"/etc/mesosphere/setup-packages/dcos-provider-azure--setup/etc/exhibitor.properties\",\"contents\":{\"source\":\"data:,com.netflix.exhibitor.azure.account-name%3D',variables('masterStorageAccountExhibitorName'),'%0Acom.netflix.exhibitor.azure.account-key%3D',listKeys(resourceId('Microsoft.Storage/storageAccounts',variables('masterStorageAccountExhibitorName')),'2015-06-15').key1,'\",\"verification\":{}},\"mode\":420}]},\"ignition\":{\"version\":\"2.0.0\",\"config\":{\"append\":[{\"source\":\"https://git.corp.adobe.com/raw/animjain/dcos-infrastructure-aetherchanges-egressrules/master/bootstrap/ignition-remote.json?token=AAA--fwrQ2omtmLAsRNHBRgB9ntf69Uoks5Yvo3FwA%3D%3D\",\"verification\":{}}]}}}'))]",
                    "linuxConfiguration": {
                        "disablePasswordAuthentication": "true",
                        "ssh": {
                            "publicKeys": [
                                {
                                    "keyData": "[variables('sshRSAPublicKey')]",
                                    "path": "[variables('sshKeyPath')]"
                                }
                            ]
                        }
                    }
                },
                "storageProfile": {
                    "imageReference": {
                        "offer": "[variables('osImageOffer')]",
                        "publisher": "[variables('osImagePublisher')]",
                        "sku": "[variables('osImageSKU')]",
                        "version": "[variables('osImageVersion')]"
                    },
                    "osDisk": {
                        "caching": "ReadWrite",
                        "createOption": "FromImage",
                        "name": "[concat(variables('masterVMNamePrefix'), copyIndex(),'-osdisk')]",
                        "vhd": {
                            "uri": "[concat(reference(concat('Microsoft.Storage/storageAccounts/',variables('masterStorageAccountName')),variables('apiVersionStorage')).primaryEndpoints.blob,'vhds/',variables('masterVMNamePrefix'),copyIndex(),'-osdisk.vhd')]"
                        }
                    }
                }
            },
            "tags": {
                "creationSource": "[concat('acsengine-', variables('masterVMNamePrefix'), copyIndex())]"
            },
            "type": "Microsoft.Compute/virtualMachines"
        }
    ],
    "variables": {
        "adminUsername": "[parameters('linuxAdminUsername')]",
        "agentcontrolAccountName": "[concat(variables('storageAccountBaseName'), 'agnt1')]",
        "agentcontrolCount": "[parameters('agentcontrolCount')]",
        "agentcontrolEndpointDNSNamePrefix": "[tolower(parameters('agentcontrolEndpointDNSNamePrefix'))]",
        "agentcontrolIPAddressName": "[concat(variables('orchestratorName'), '-agent-ip-', variables('agentcontrolEndpointDNSNamePrefix'), '-', variables('nameSuffix'))]",
        "agentcontrolLbBackendPoolName": "[concat(variables('orchestratorName'), '-agentcontrol-', variables('nameSuffix'))]",
        "agentcontrolLbID": "[resourceId('Microsoft.Network/loadBalancers',variables('agentcontrolLbName'))]",
        "agentcontrolLbIPConfigID": "[concat(variables('agentcontrolLbID'),'/frontendIPConfigurations/', variables('agentcontrolLbIPConfigName'))]",
        "agentcontrolLbIPConfigName": "[concat(variables('orchestratorName'), '-agentcontrol-', variables('nameSuffix'))]",
        "agentcontrolLbName": "[concat(variables('orchestratorName'), '-agentcontrol-', variables('nameSuffix'))]",
        "agentcontrolNSGID": "[resourceId('Microsoft.Network/networkSecurityGroups',variables('agentcontrolNSGName'))]",
        "agentcontrolNSGName": "[concat(variables('orchestratorName'), '-agentcontrol-nsg-', variables('nameSuffix'))]",
        "agentcontrolStorageAccountOffset": "[mul(variables('maxStorageAccountsPerAgent'),1)]",
        "agentcontrolStorageAccountsCount": "[variables('maxStorageAccountsPerAgent')]",
        "agentcontrolSubnet": "[parameters('agentcontrolSubnet')]",
        "agentcontrolSubnetName": "[concat(variables('orchestratorName'), '-agentcontrolSubnet')]",
        "agentcontrolVMNamePrefix": "[concat(variables('orchestratorName'), '-agentcontrol-', variables('nameSuffix'))]",
        "agentcontrolVMSize": "[parameters('agentcontrolVMSize')]",
        "agentcontrolVnetSubnetID": "[concat(variables('vnetID'),'/subnets/',variables('agentcontrolSubnetName'))]",
        "agentproxyAccountName": "[concat(variables('storageAccountBaseName'), 'agnt2')]",
        "agentproxyCount": "[parameters('agentproxyCount')]",
        "agentproxyEndpointDNSNamePrefix": "[tolower(parameters('agentproxyEndpointDNSNamePrefix'))]",
        "agentproxyIPAddressName": "[concat(variables('orchestratorName'), '-agent-ip-', variables('agentproxyEndpointDNSNamePrefix'), '-', variables('nameSuffix'))]",
        "agentproxyLbBackendPoolName": "[concat(variables('orchestratorName'), '-agentproxy-', variables('nameSuffix'))]",
        "agentproxyLbID": "[resourceId('Microsoft.Network/loadBalancers',variables('agentproxyLbName'))]",
        "agentproxyLbIPConfigID": "[concat(variables('agentproxyLbID'),'/frontendIPConfigurations/', variables('agentproxyLbIPConfigName'))]",
        "agentproxyLbIPConfigName": "[concat(variables('orchestratorName'), '-agentproxy-', variables('nameSuffix'))]",
        "agentproxyLbName": "[concat(variables('orchestratorName'), '-agentproxy-', variables('nameSuffix'))]",
        "agentproxyNSGID": "[resourceId('Microsoft.Network/networkSecurityGroups',variables('agentproxyNSGName'))]",
        "agentproxyNSGName": "[concat(variables('orchestratorName'), '-agentproxy-nsg-', variables('nameSuffix'))]",
        "agentproxyStorageAccountOffset": "[mul(variables('maxStorageAccountsPerAgent'),2)]",
        "agentproxyStorageAccountsCount": "[variables('maxStorageAccountsPerAgent')]",
        "agentproxySubnet": "[parameters('agentproxySubnet')]",
        "agentproxySubnetName": "[concat(variables('orchestratorName'), '-agentproxySubnet')]",
        "agentproxyVMNamePrefix": "[concat(variables('orchestratorName'), '-agentproxy-', variables('nameSuffix'))]",
        "agentproxyVMSize": "[parameters('agentproxyVMSize')]",
        "agentproxyVnetSubnetID": "[concat(variables('vnetID'),'/subnets/',variables('agentproxySubnetName'))]",
        "agentworkerAccountName": "[concat(variables('storageAccountBaseName'), 'agnt0')]",
        "agentworkerCount": "[parameters('agentworkerCount')]",
        "agentworkerEndpointDNSNamePrefix": "[tolower(parameters('agentworkerEndpointDNSNamePrefix'))]",
        "agentworkerIPAddressName": "[concat(variables('orchestratorName'), '-agent-ip-', variables('agentworkerEndpointDNSNamePrefix'), '-', variables('nameSuffix'))]",
        "agentworkerLbBackendPoolName": "[concat(variables('orchestratorName'), '-agentworker-', variables('nameSuffix'))]",
        "agentworkerLbID": "[resourceId('Microsoft.Network/loadBalancers',variables('agentworkerLbName'))]",
        "agentworkerLbIPConfigID": "[concat(variables('agentworkerLbID'),'/frontendIPConfigurations/', variables('agentworkerLbIPConfigName'))]",
        "agentworkerLbIPConfigName": "[concat(variables('orchestratorName'), '-agentworker-', variables('nameSuffix'))]",
        "agentworkerLbName": "[concat(variables('orchestratorName'), '-agentworker-', variables('nameSuffix'))]",
        "agentworkerNSGID": "[resourceId('Microsoft.Network/networkSecurityGroups',variables('agentworkerNSGName'))]",
        "agentworkerNSGName": "[concat(variables('orchestratorName'), '-agentworker-nsg-', variables('nameSuffix'))]",
        "agentworkerStorageAccountOffset": "[mul(variables('maxStorageAccountsPerAgent'),0)]",
        "agentworkerStorageAccountsCount": "[variables('maxStorageAccountsPerAgent')]",
        "agentworkerSubnet": "[parameters('agentworkerSubnet')]",
        "agentworkerSubnetName": "[concat(variables('orchestratorName'), '-agentworkerSubnet')]",
        "agentworkerVMNamePrefix": "[concat(variables('orchestratorName'), '-agentworker-', variables('nameSuffix'))]",
        "agentworkerVMSize": "[parameters('agentworkerVMSize')]",
        "agentworkerVnetSubnetID": "[concat(variables('vnetID'),'/subnets/',variables('agentworkerSubnetName'))]",
        "agentworkeraetherAccountName": "[concat(variables('storageAccountBaseName'), 'agnt11')]",
        "agentworkeraetherCount": "[parameters('agentworkeraetherCount')]",
        "agentworkeraetherEndpointDNSNamePrefix": "[tolower(parameters('agentworkeraetherEndpointDNSNamePrefix'))]",
        "agentworkeraetherIPAddressName": "[concat(variables('orchestratorName'), '-agent-ip-', variables('agentworkeraetherEndpointDNSNamePrefix'), '-', variables('nameSuffix'))]",
        "agentworkeraetherLbBackendPoolName": "[concat(variables('orchestratorName'), '-agentworkeraether-', variables('nameSuffix'))]",
        "agentworkeraetherLbID": "[resourceId('Microsoft.Network/loadBalancers',variables('agentworkeraetherLbName'))]",
        "agentworkeraetherLbIPConfigID": "[concat(variables('agentworkeraetherLbID'),'/frontendIPConfigurations/', variables('agentworkeraetherLbIPConfigName'))]",
        "agentworkeraetherLbIPConfigName": "[concat(variables('orchestratorName'), '-agentworkeraether-', variables('nameSuffix'))]",
        "agentworkeraetherLbName": "[concat(variables('orchestratorName'), '-agentworkeraether-', variables('nameSuffix'))]",
        "agentworkeraetherNSGID": "[resourceId('Microsoft.Network/networkSecurityGroups',variables('agentworkeraetherNSGName'))]",
        "agentworkeraetherNSGName": "[concat(variables('orchestratorName'), '-agentworkeraether-nsg-', variables('nameSuffix'))]",
        "agentworkeraetherStorageAccountOffset": "[mul(variables('maxStorageAccountsPerAgent'),11)]",
        "agentworkeraetherStorageAccountsCount": "[variables('maxStorageAccountsPerAgent')]",
        "agentworkeraetherSubnet": "[parameters('agentworkeraetherSubnet')]",
        "agentworkeraetherSubnetName": "[concat(variables('orchestratorName'), '-agentworkeraetherSubnet')]",
        "agentworkeraetherVMNamePrefix": "[concat(variables('orchestratorName'), '-agentworkeraether-', variables('nameSuffix'))]",
        "agentworkeraetherVMSize": "[parameters('agentworkeraetherVMSize')]",
        "agentworkeraetherVnetSubnetID": "[concat(variables('vnetID'),'/subnets/',variables('agentworkeraetherSubnetName'))]",
        "apiVersionDefault": "2016-03-30",
        "apiVersionStorage": "2015-06-15",
        "dataStorageAccountPrefixSeed": 97,
        "masterAvailabilitySet": "[concat(variables('orchestratorName'), '-master-availabilitySet-', variables('nameSuffix'))]",
        "masterCount": 3,
        "masterEndpointDNSNamePrefix": "[tolower(parameters('masterEndpointDNSNamePrefix'))]",
        "masterFirstAddrOctet4": "[variables('masterFirstAddrOctets')[3]]",
        "masterFirstAddrOctets": "[split(parameters('firstConsecutiveStaticIP'),'.')]",
        "masterFirstAddrPrefix": "[concat(variables('masterFirstAddrOctets')[0],'.',variables('masterFirstAddrOctets')[1],'.',variables('masterFirstAddrOctets')[2],'.')]",
        "masterLbBackendPoolName": "[concat(variables('orchestratorName'), '-master-pool-', variables('nameSuffix'))]",
        "masterLbID": "[resourceId('Microsoft.Network/loadBalancers',variables('masterLbName'))]",
        "masterLbIPConfigID": "[concat(variables('masterLbID'),'/frontendIPConfigurations/', variables('masterLbIPConfigName'))]",
        "masterLbIPConfigName": "[concat(variables('orchestratorName'), '-master-lbFrontEnd-', variables('nameSuffix'))]",
        "masterLbName": "[concat(variables('orchestratorName'), '-master-lb-', variables('nameSuffix'))]",
        "masterNSGID": "[resourceId('Microsoft.Network/networkSecurityGroups',variables('masterNSGName'))]",
        "masterNSGName": "[concat(variables('orchestratorName'), '-master-nsg-', variables('nameSuffix'))]",
        "masterPublicIPAddressName": "[concat(variables('orchestratorName'), '-master-ip-', variables('masterEndpointDNSNamePrefix'), '-', variables('nameSuffix'))]",
        "masterStorageAccountExhibitorName": "[concat(variables('storageAccountBaseName'), 'exhb0')]",
        "masterStorageAccountName": "[concat(variables('storageAccountBaseName'), 'mstr0')]",
        "masterSubnet": "[parameters('masterSubnet')]",
        "masterSubnetName": "[concat(variables('orchestratorName'), '-masterSubnetName')]",
        "masterVMNamePrefix": "[concat(variables('orchestratorName'), '-master-', variables('nameSuffix'), '-')]",
        "masterVMNic": [
            "[concat(variables('masterVMNamePrefix'), 'nic-0')]",
            "[concat(variables('masterVMNamePrefix'), 'nic-1')]",
            "[concat(variables('masterVMNamePrefix'), 'nic-2')]",
            "[concat(variables('masterVMNamePrefix'), 'nic-3')]",
            "[concat(variables('masterVMNamePrefix'), 'nic-4')]",
            "[concat(variables('masterVMNamePrefix'), 'nic-5')]",
            "[concat(variables('masterVMNamePrefix'), 'nic-6')]"
        ],
        "masterVMSize": "[parameters('masterVMSize')]",
        "masterVnetSubnetID": "[concat(variables('vnetID'),'/subnets/',variables('masterSubnetName'))]",
        "maxStorageAccountsPerAgent": "[div(variables('maxVMsPerPool'),variables('maxVMsPerStorageAccount'))]",
        "maxVMsPerPool": 100,
        "maxVMsPerStorageAccount": 20,
        "nameSuffix": "[parameters('nameSuffix')]",
        "oauthEnabled": "true",
        "orchestratorName": "dcos",
        "osImageOffer": "CoreOS",
        "osImagePublisher": "CoreOS",
        "osImageSKU": "Stable",
        "osImageVersion": "latest",
        "sshKeyPath": "[concat('/home/', variables('adminUsername'), '/.ssh/authorized_keys')]",
        "sshRSAPublicKey": "[parameters('sshRSAPublicKey')]",
        "storageAccountBaseName": "[uniqueString(concat(variables('masterEndpointDNSNamePrefix'),resourceGroup().location, variables('orchestratorName')))]",
        "storageAccountPrefixes": [
            "0",
            "6",
            "c",
            "i",
            "o",
            "u",
            "1",
            "7",
            "d",
            "j",
            "p",
            "v",
            "2",
            "8",
            "e",
            "k",
            "q",
            "w",
            "3",
            "9",
            "f",
            "l",
            "r",
            "x",
            "4",
            "a",
            "g",
            "m",
            "s",
            "y",
            "5",
            "b",
            "h",
            "n",
            "t",
            "z"
        ],
        "storageAccountPrefixesCount": "[length(variables('storageAccountPrefixes'))]",
        "storageAccountType": "Standard_LRS",
        "virtualNetworkName": "[concat(variables('orchestratorName'), '-vnet-', variables('nameSuffix'))]",
        "vmSizesMap": {
            "Basic_A2": {
                "storageAccountType": "Standard_LRS"
            },
            "Basic_A3": {
                "storageAccountType": "Standard_LRS"
            },
            "Basic_A4": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A10": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A11": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A2_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A2m_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A3": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A4": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A4_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A4m_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A5": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A6": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A7": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A8": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A8_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A8m_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_A9": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D11": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D11_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D12": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D12_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D13": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D13_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D14": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D14_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D15_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D2_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D3": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D3_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D4": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D4_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_D5_v2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_DS11": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS11_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS12": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS12_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS13": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS13_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS14": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS14_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS15_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS2_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS3": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS3_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS4": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS4_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_DS5_v2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_F16": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F16s": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F2s": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F4": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F4s": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F8": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_F8s": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_G1": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_G2": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_G3": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_G4": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_G5": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_GS1": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_GS2": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_GS3": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_GS4": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_GS5": {
                "storageAccountType": "Premium_LRS"
            },
            "Standard_H16": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_H16m": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_H16mr": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_H16r": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_H8": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_H8m": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NC12": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NC24": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NC24r": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NC6": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NV12": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NV24": {
                "storageAccountType": "Standard_LRS"
            },
            "Standard_NV6": {
                "storageAccountType": "Standard_LRS"
            }
        },
        "vnetID": "[resourceId('Microsoft.Network/virtualNetworks',variables('virtualNetworkName'))]"
    }
}